{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "WAGov - Threat Hunting - Rapid IOC Search",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "WorkspaceName": {
        "type": "string",
        "defaultValue": "<Add log analytics workspace name>",
        "minLength": 1,
        "metadata": {
            "description": "The name of the Log Analytics workspace to which this workbook will be associated"
        }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
"variables": {
	"workbookSourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('WorkspaceName'))]"
    	},
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::selected\"],\"parameters\":[{\"id\":\"8e7728b6-d24b-484f-8882-30681973ac2a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"Resources\\r\\n| summarize Count = count() by subscriptionId\\r\\n| order by Count desc\\r\\n| extend Rank = row_number()\\r\\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1\",\"crossComponentResources\":[\"value::selected\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[]},{\"id\":\"41102d0e-96f6-42aa-9496-d43573a7537a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains 'SecurityInsights' | project id = tostring(properties.workspaceResourceId)\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":null},{\"id\":\"79b21540-298d-4224-8349-fb32b4cb02e9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2592000000}},{\"id\":\"8d9f06c4-b230-46cc-ae35-4c6b6ddb25c5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Instructions\",\"label\":\"Show Instructions\",\"type\":10,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\n    { \\\"value\\\":\\\"Hide\\\", \\\"label\\\":\\\"Hide\\\",\\\"selected\\\":true},\\n    { \\\"value\\\":\\\"Show\\\", \\\"label\\\":\\\"Show\\\" }\\n]\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"This workbook help analyst to perform IOC threat hunting activites in their own agency. The search results allow SOC Analyst to immediately identify table and agency of interest, to be able to perform deeper analysis at agency's own workspaces. \\nPlease Note: The workbooks does not guarantee 100% coverage of all logs, Security analyst needs to perform further analysis in Log Analytics workspace.\\n\\n---\\n## Instructions:\\n1. Select Workspace (Default to all)\\n2. Define Time Range of search.\\n3. Prepare your IOCs. Supported IOCs (FileHash,IP Address, URL, Email)\\n4. Copy-paste your search query into the \\\"Search Query\\\" field\\n5. Contact cybersecurity@dpc.wa.gov.au for further enquiries and training on this workbook\"},\"conditionalVisibility\":{\"parameterName\":\"Instructions\",\"comparison\":\"isEqualTo\",\"value\":\"Show\"},\"name\":\"text - 0\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"tabStyle\":\"bigger\",\"links\":[{\"id\":\"4d3e6860-e43a-4b79-acac-f7fa20cfe0a5\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IP Address\",\"subTarget\":\"ip\",\"style\":\"link\"},{\"id\":\"dd6cbcf7-9e1f-4533-8003-45b4d2e989e8\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"File Hash\",\"subTarget\":\"filehash\",\"style\":\"link\"},{\"id\":\"61df5b01-b497-4525-94b0-cad9d87aaea0\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"URL\",\"subTarget\":\"url\",\"style\":\"link\"},{\"id\":\"f861bc97-f235-414b-82df-898af0b47a87\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Email (External)\",\"subTarget\":\"email_external\",\"style\":\"link\"}]},\"name\":\"links - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"28514c62-46bc-49f9-9b5e-ce7b5512200e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IP_IOC\",\"label\":\"IP Addresses\",\"type\":1,\"description\":\"Add IP addresses in array format e.g. (\\\"1.1.1.1\\\",\\\"8.8.8.8\\\")\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\"},\"timeContext\":{\"durationMs\":86400000},\"value\":\"(\\\"8.8.8.8\\\",\\\"1.1.1.1\\\")\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 3\"},{\"type\":1,\"content\":{\"json\":\"### SecurityAlert\"},\"name\":\"text - 47\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n|summarize arg_max(TimeGenerated,*) by SystemAlertId\\r\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\r\\n| mvexpand Entities\\r\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\r\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\r\\n| extend Entity_Name = columnifexists(\\\"Entity_Name\\\", \\\"\\\")\\r\\n| extend Entity_ResourceId = columnifexists(\\\"Entity_ResourceId\\\", \\\"\\\")\\r\\n| extend Entity_Directory = columnifexists(\\\"Entity_Directory\\\", \\\"\\\")\\r\\n| extend Entity_Value = columnifexists(\\\"Entity_Value\\\", \\\"\\\")\\r\\n| extend Entity_HostName = columnifexists(\\\"Entity_HostName\\\", \\\"\\\")\\r\\n| extend Entity_Address = columnifexists(\\\"Entity_Address\\\", \\\"\\\")\\r\\n| extend Entity_ProcessId = columnifexists(\\\"Entity_ProcessId\\\", \\\"\\\")\\r\\n| extend Entity_Url = columnifexists(\\\"Entity_Url\\\", \\\"\\\")\\r\\n| extend Target = iif(Entity_Type == \\\"account\\\", Entity_Name, iif(Entity_Type == \\\"azure-resource\\\", Entity_ResourceId, iif(Entity_Type == \\\"cloud-application\\\", Entity_Name, iif(Entity_Type == \\\"dns\\\", Entity_Name, iif(Entity_Type == \\\"file\\\", strcat(Entity_Directory, \\\"\\\\\\\\\\\", Entity_Name), iif(Entity_Type == \\\"filehash\\\", Entity_Value, iif(Entity_Type == \\\"host\\\", Entity_HostName, iif(Entity_Type == \\\"ip\\\" , Entity_Address, iif(Entity_Type == \\\"malware\\\", Entity_HostName, iif(Entity_Type == \\\"network-connection\\\", Entity_Name, iif(Entity_Type == \\\"process\\\", Entity_ProcessId, iif(Entity_Type == \\\"registry-key\\\", Entity_Name, iif(Entity_Type == \\\"registry-value\\\", Entity_Name, iif(Entity_Type == \\\"security-group\\\", Entity_Name, iif(Entity_Type == \\\"url\\\", Entity_Url, \\\"NoTarget\\\")))))))))))))))\\r\\n| where Entity_Type == \\\"ip\\\"\\r\\n|where Target has_any {IP_IOC}\\r\\n|summarize IOC=make_set(Target), AlertName=make_set(AlertName),SystemAlertId=make_set(SystemAlertId) ,count_=count(Target) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend AlertName = tostring(strcat_array(AlertName,\\\", \\\")), SystemAlertId = tostring(strcat_array(SystemAlertId,\\\", \\\"))\\r\\n|project AlertName, SystemAlertId, count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityAlert - IP\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"SecurityAlert\"},{\"type\":1,\"content\":{\"json\":\"### Azure Active Directory\"},\"name\":\"text - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress), count_=count(IPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SigninLogs - IPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AAD-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AADNonInteractiveUserSignInLogs\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress), count_=count(IPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AADNonInteractiveUserSignInLogs - IPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AAD-2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AADServicePrincipalSignInLogs\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress), count_=count(IPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AADServicePrincipalSignInLogs - IPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AAD-3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ADFSSignInLogs\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress), count_=count(IPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"ADFSSignInLogs - IPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"Agency_Short\",\"label\":\"Agency\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AAD-4\"},{\"type\":1,\"content\":{\"json\":\"### Azure Activity, Azure AD Identity Protection,Microsoft Defender for Cloud, Azure Information Protection\"},\"name\":\"text - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where CallerIpAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(CallerIpAddress), count_=count(CallerIpAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AzureActivity - CallerIpAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AzureActivity-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n|where ProviderName == \\\"IPC\\\"\\r\\n|extend IPAddress_ = tostring(parse_json(ExtendedProperties).[\\\"Client IP Address\\\"])\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress_ has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress_), count_=count(IPAddress_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure AD Identity Protection - IPAddress_\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AADIPC-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n|where ProviderName == \\\"Azure Security Center\\\"\\r\\n|extend IPAddress_ = tostring(parse_json(ExtendedProperties).Answers)\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddress_ has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddress_), count_=count(IPAddress_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Microsoft Defender for Cloud - IPAddress_\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"Agency_Short\",\"label\":\"Agency\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"Microsoft Defender for Cloud\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"InformationProtectionLogs_CL\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPv4_s has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPv4_s), count_=count(IPv4_s) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Azure Information Protection - IPv4_s\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContext\":{\"durationMs\":14400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"AzureInformationProtection-IP\"},{\"type\":1,\"content\":{\"json\":\"### DNS Inventory\"},\"name\":\"text - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DnsEvents\\r\\n|where SubType == \\\"LookupQuery\\\"\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where IPAddresses has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddresses), count_=count(IPAddresses) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"DNSEvents - IPAddresses\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"DNSEvents-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DnsEvents\\r\\n|where SubType == \\\"LookupQuery\\\"\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where MaliciousIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(MaliciousIP), count_=count(MaliciousIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"DNSEvents - MaliciousIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"Agency_Short\",\"label\":\"Agency\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"DNSEvents-2\"},{\"type\":1,\"content\":{\"json\":\"### CommonSecurityLog\"},\"name\":\"text - 2 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where SourceIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SourceIP), count_=count(SourceIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog- SourceIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"CommonSecurityLog-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where DestinationIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(DestinationIP), count_=count(DestinationIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog- DestinationIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"CommonSecurityLog-2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where MaliciousIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(MaliciousIP), count_=count(MaliciousIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog- MaliciousIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"Agency_Short\",\"label\":\"Agency\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"CommonSecurityLog-3\"},{\"type\":1,\"content\":{\"json\":\"### OfficeActivity\"},\"name\":\"OfficeActivity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OfficeActivity\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where ClientIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(ClientIP),Type_=make_set(OfficeWorkload), count_=count(ClientIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend Type_ = tostring(strcat_array(Type_,\\\", \\\"))\\r\\n|project count_ ,IOC,Type_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"OfficeActivity (Other than Exchange) - ClientIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Agency\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"2fr\"}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"1fr\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"3fr\"}},{\"columnMatch\":\"Type_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"2fr\"}}],\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"},{\"columnId\":\"Type_\",\"label\":\"Activity Type\"}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"OfficeActivity-1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OfficeActivity\\r\\n|where OfficeWorkload == \\\"Exchange\\\"\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|where Client_IPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(Client_IPAddress), count_=count(Client_IPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"OfficeActivity(Exchange) - Client_IPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"OfficeActivity-2\"},{\"type\":1,\"content\":{\"json\":\"### Syslog\"},\"name\":\"Syslog\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n|where TimeGenerated {TimeRange:query}\\r\\n|extend IPAddresses_ = extract_all(@\\\"((?:[0-9]{1,3}\\\\.){3}[0-9]{1,3})\\\",SyslogMessage) //Extracting IP addresses from Syslog Message\\r\\n|where isnotempty(IPAddresses_) //Further data filter, only show records with IP Addresses\\r\\n|mv-expand IPAddresses_ // Expand the dynamic results into individual rows\\r\\n|where IPAddresses_ has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPAddresses_), count_=count(IPAddresses_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Syslog - IPAddresses_ (Regex:SyslogMessage) \",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"Syslog\"},{\"type\":1,\"content\":{\"json\":\"### Sysmon\"},\"name\":\"Event\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID ==3\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"SourceIp\\\\\\\">\\\" SourceIp \\\"</Data>\\\" * //parsing specific field inside EventID 3\\r\\n|summarize count() by TenantId, tostring(SourceIp) //Performance tweak\\r\\n|where SourceIp has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SourceIp), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - EventID 3 - SourceIP \",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 3 - SourceIp\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID ==3\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"DestinationIp\\\\\\\">\\\" DestinationIp \\\"</Data>\\\" * //parsing specific field inside EventID 3\\r\\n|summarize count() by TenantId, tostring(DestinationIp) //Performance tweak\\r\\n|where DestinationIp has_any {IP_IOC}\\r\\n|summarize IOC=make_set(DestinationIp), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - EventID 3 - DestinationIp\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 3 - DestinationIp\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 22\\r\\n|project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"QueryResults\\\\\\\">\\\" QueryResults \\\"</Data>\\\" * //parsing specific field inside EventID 22\\r\\n|summarize count() by TenantId, tostring(QueryResults) //Performance tweak\\r\\n|where QueryResults has_any {IP_IOC}\\r\\n|summarize IOC=make_set(QueryResults), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project count_ ,IOC\\r\\n|sort by count_ desc\\r\\n\",\"size\":1,\"title\":\"Sysmon - EventID 22 - QueryResults\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Agency\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"5%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"QueryName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"90\",\"name\":\"Sysmon - 22 - QueryResults\"},{\"type\":1,\"content\":{\"json\":\"### Notes\\r\\n\\r\\nThe EventID:22 results contains resolved domain(s) only, given the vast variations of data format in the raw data\"},\"customWidth\":\"10\",\"name\":\"text - 27\"},{\"type\":1,\"content\":{\"json\":\"### Security Events\"},\"name\":\"Security Events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n|where IpAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IpAddress),EventID=make_set(EventID), count_=count(IpAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend EventID = tostring(strcat_array(EventID,\\\", \\\"))\\r\\n|project EventID, IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityEvents - IpAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"SecurityEvent-IpAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n|where EventID in (5156,5157)\\r\\n|extend EvData = parse_xml(EventData)\\r\\n|extend EventDetail = EvData.EventData.Data\\r\\n| project-away EventData, EvData\\r\\n|extend SourceAddress = EventDetail.[3].[\\\"#text\\\"], DestAddress = EventDetail.[5].[\\\"#text\\\"]\\r\\n|where SourceAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SourceAddress),EventID=make_set(EventID), count_=count(SourceAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend EventID = tostring(strcat_array(EventID,\\\", \\\"))\\r\\n|project EventID, IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityEvents - SourceAddress (EventID: 5156 & 5157 Only)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"SecurityEvent-SourceAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n|where EventID in (5156,5157)\\r\\n|extend EvData = parse_xml(EventData)\\r\\n|extend EventDetail = EvData.EventData.Data\\r\\n| project-away EventData, EvData\\r\\n|extend SourceAddress = EventDetail.[3].[\\\"#text\\\"], DestAddress = EventDetail.[5].[\\\"#text\\\"]\\r\\n|where DestAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(DestAddress),EventID=make_set(EventID), count_=count(DestAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend EventID = tostring(strcat_array(EventID,\\\", \\\"))\\r\\n|project EventID, IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityEvents - DestAddress (EventID: 5156 & 5157 Only)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"SecurityEvent-DestAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\r\\n|where EventID == 5158\\r\\n|extend EvData = parse_xml(EventData)\\r\\n|extend EventDetail = EvData.EventData.Data\\r\\n| project-away EventData, EvData\\r\\n|extend SourceAddress = EventDetail.[2].[\\\"#text\\\"]\\r\\n|where SourceAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SourceAddress),EventID=make_set(EventID), count_=count(SourceAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend EventID = tostring(strcat_array(EventID,\\\", \\\"))\\r\\n|project  EventID, IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityEvents - SourceAddress (EventID: 5158 Only)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"SecurityEvent-SourceAddress - 5158\"},{\"type\":1,\"content\":{\"json\":\"### Microsoft Defender For Endpoint\"},\"name\":\"Microsoft Defender for Endpoint\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n|where FileOriginIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(FileOriginIP), count_=count(FileOriginIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - FileOriginIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceEvents - FileOriginIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n|where LocalIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(LocalIP), count_=count(LocalIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - LocalIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceEvents - LocalIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n|where RemoteIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(RemoteIP), count_=count(RemoteIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - RemoteIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceEvents - RemoteIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\r\\n|where FileOriginIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(FileOriginIP), count_=count(FileOriginIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - FileOriginIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceFileEvents - FileOriginIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\r\\n|where RequestSourceIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(RequestSourceIP), count_=count(RequestSourceIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - RequestSourceIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}]},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceFileEvents - RequestSourceIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceInfo\\r\\n|where PublicIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(PublicIP), count_=count(PublicIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceInfo - PublicIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceInfo - PublicIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceLogonEvents\\r\\n|where RemoteIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(RemoteIP), count_=count(RemoteIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceLogonEvents - RemoteIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceLogonEvents- RemoteIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkEvents\\r\\n|where LocalIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(LocalIP), count_=count(LocalIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceNetworkEvents - LocalIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceNetworkEvents - LocalIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkEvents\\r\\n|where RemoteIP has_any {IP_IOC}\\r\\n|summarize IOC=make_set(RemoteIP), count_=count(RemoteIP) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceNetworkEvents - RemoteIP\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"MSDE - DeviceNetworkEvents - RemoteIP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkInfo\\r\\n|where IPv4Dhcp has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPv4Dhcp), count_=count(IPv4Dhcp) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceNetworkInfo - IPv4Dhcp\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceNetworkInfo - IPv4Dhcp\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkInfo\\r\\n|where IPv6Dhcp has_any {IP_IOC}\\r\\n|summarize IOC=make_set(IPv6Dhcp), count_=count(IPv6Dhcp) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceNetworkInfo - IPv6Dhcp\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}]},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceNetworkInfo - IPv6Dhcp\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Office 365\"},\"name\":\"text - 53\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\r\\n|where SenderIPv4 has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SenderIPv4), count_=count(SenderIPv4) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - EmailEvents - SenderIPv4\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"50\",\"name\":\"MSDE - EmailEvents - SenderIPv4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\r\\n|where SenderIPv6 has_any {IP_IOC}\\r\\n|summarize IOC=make_set(SenderIPv6), count_=count(SenderIPv6) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|project IOC, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - EmailEvents - SenderIPv6\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}]},\"customWidth\":\"50\",\"name\":\"MSDE - EmailEvents - SenderIPv6\"},{\"type\":1,\"content\":{\"json\":\"### Azure Diagnostics\"},\"name\":\"text - 49\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureDiagnostics\\r\\n|where clientIp_s has_any {IP_IOC}\\r\\n|summarize IOC=make_set(clientIp_s), Category=make_set(Category), count_=count(clientIp_s) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Category = tostring(strcat_array(Category,\\\", \\\"))\\r\\n|project IOC, Category, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AzureDiagnostics - clientIp_s\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}]},\"customWidth\":\"33\",\"name\":\"AzureDiagnostics - clientIp_s \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureDiagnostics\\r\\n|where clientIP_s has_any {IP_IOC}\\r\\n|summarize IOC=make_set(clientIP_s), Category=make_set(Category), count_=count(clientIP_s) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Category = tostring(strcat_array(Category,\\\", \\\"))\\r\\n|project IOC, Category, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AzureDiagnostics - clientIP_s\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"AzureDiagnostics - clientIP_s\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureDiagnostics\\r\\n|where CallerIPAddress has_any {IP_IOC}\\r\\n|summarize IOC=make_set(CallerIPAddress), Category=make_set(Category), count_=count(CallerIPAddress) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Category = tostring(strcat_array(Category,\\\", \\\"))\\r\\n|project IOC, Category, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AzureDiagnostics - CallerIPAddress\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"Agency\",\"sortOrder\":1}]},\"customWidth\":\"33\",\"name\":\"AzureDiagnostics - CallerIPAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureDiagnostics\\r\\n|where client_ip_s has_any {IP_IOC}\\r\\n|summarize IOC=make_set(client_ip_s), Category=make_set(Category), count_=count(client_ip_s) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Category = tostring(strcat_array(Category,\\\", \\\"))\\r\\n|project IOC, Category, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"AzureDiagnostics - client_ip_s\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[]},\"customWidth\":\"33\",\"name\":\"AzureDiagnostics - client_ip_s\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ip\"},\"name\":\"ip-address\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"version\":\"KqlParameterItem/1.0\",\"name\":\"SHA256_IOC\",\"label\":\"SHA256 Hash\",\"type\":1,\"description\":\"Add SHA1 hashes in array format e.g. (\\\"hash1\\\",\\\"hash2\\\")\",\"value\":\"(\\\"9327b77c27070db62a6da46f0c1d8da2725c5ae0c24d6ccf9be6aa0da5f99600\\\",\\\"f157090fd3ccd4220298c06ce8734361b724d80459592b10ac632acc624f455e\\\",\\\"f11009988b813821857c8d2db0f88e1d45b20762f62a3cf432339f352b12cefe\\\")\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\"},\"timeContext\":{\"durationMs\":86400000},\"id\":\"2732e809-7fbd-4241-a435-ad6d44ac07ec\"},{\"id\":\"519ef4e6-ec90-4fcf-9e77-79bd28e27e4e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SHA1_IOC\",\"type\":1,\"description\":\"Add SHA 256 hashes in array format e.g. (\\\"hash1\\\",\\\"hash2\\\")\",\"value\":\"(\\\"c8f5825499315eaf4b5046ff79ac9553e71ad1c0\\\")\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\"},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"fbe9622d-a202-4e71-b7cf-7a6f9343ca96\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IMPHASH\",\"type\":1,\"description\":\"Add IMPHASH hashes in array format e.g. (\\\"hash1\\\",\\\"hash2\\\")\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\"},\"timeContext\":{\"durationMs\":86400000},\"value\":\"(\\\"c8f5825499315eaf4b5046ff79ac9553e71ad1c0\\\")\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 0\"},{\"type\":1,\"content\":{\"json\":\"# Notes:\\r\\n- Prioritize in using SHA256 over SHA1, unless certain table that only accepts SHA1\\r\\n- If only SHA1 information available, use VirusTotal to grab the SHA256\"},\"conditionalVisibility\":{\"parameterName\":\"Instructions\",\"comparison\":\"isEqualTo\",\"value\":\"Show\"},\"name\":\"text - 16\"},{\"type\":1,\"content\":{\"json\":\"## SecurityAlert - FileHash\"},\"name\":\"SecurityAlert2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\r\\n|summarize arg_max(TimeGenerated,*) by SystemAlertId\\r\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\r\\n| mv-expand Entities\\r\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\r\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\r\\n| extend Entity_Name = columnifexists(\\\"Entity_Name\\\", \\\"\\\")\\r\\n| extend Entity_ResourceId = columnifexists(\\\"Entity_ResourceId\\\", \\\"\\\")\\r\\n| extend Entity_Directory = columnifexists(\\\"Entity_Directory\\\", \\\"\\\")\\r\\n| extend Entity_Value = columnifexists(\\\"Entity_Value\\\", \\\"\\\")\\r\\n| extend Entity_HostName = columnifexists(\\\"Entity_HostName\\\", \\\"\\\")\\r\\n| extend Entity_Address = columnifexists(\\\"Entity_Address\\\", \\\"\\\")\\r\\n| extend Entity_ProcessId = columnifexists(\\\"Entity_ProcessId\\\", \\\"\\\")\\r\\n| extend Entity_Url = columnifexists(\\\"Entity_Url\\\", \\\"\\\")\\r\\n| extend Target = iif(Entity_Type == \\\"account\\\", Entity_Name, iif(Entity_Type == \\\"azure-resource\\\", Entity_ResourceId, iif(Entity_Type == \\\"cloud-application\\\", Entity_Name, iif(Entity_Type == \\\"dns\\\", Entity_Name, iif(Entity_Type == \\\"file\\\", strcat(Entity_Directory, \\\"\\\\\\\\\\\", Entity_Name), iif(Entity_Type == \\\"filehash\\\", Entity_Value, iif(Entity_Type == \\\"host\\\", Entity_HostName, iif(Entity_Type == \\\"ip\\\" , Entity_Address, iif(Entity_Type == \\\"malware\\\", Entity_HostName, iif(Entity_Type == \\\"network-connection\\\", Entity_Name, iif(Entity_Type == \\\"process\\\", Entity_ProcessId, iif(Entity_Type == \\\"registry-key\\\", Entity_Name, iif(Entity_Type == \\\"registry-value\\\", Entity_Name, iif(Entity_Type == \\\"security-group\\\", Entity_Name, iif(Entity_Type == \\\"url\\\", Entity_Url, \\\"NoTarget\\\")))))))))))))))\\r\\n|where Entity_Type == \\\"filehash\\\"\\r\\n|where Entity_Algorithm == \\\"SHA256\\\"\\r\\n|where Target has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(Target), AlertName=make_set(AlertName),SystemAlertId=make_set(SystemAlertId) ,count_=count(Target) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend AlertName = tostring(strcat_array(AlertName,\\\", \\\")), SystemAlertId = tostring(strcat_array(SystemAlertId,\\\", \\\"))\\r\\n|project AlertName, SystemAlertId, count_ ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityAlert - FileHash - SHA256\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"SystemAlertId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"SecurityAlert - FileHash\"},{\"type\":1,\"content\":{\"json\":\"## CommonSecurityLog\"},\"name\":\"text - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n|where FileHash has_any {SHA1_IOC}\\r\\n|summarize IOC=make_set(FileHash), FileName=make_set(FileName) ,count_=count(FileHash) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC, FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog - FileHash - SHA1\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"CommonSecurityLog - FileHash - SHA1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n|where FileHash has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(FileHash), FileName=make_set(FileName) ,count_=count(FileHash) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC, FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog - FileHash - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"CommonSecurityLog - FileHash - SHA256\"},{\"type\":1,\"content\":{\"json\":\"## Sysmon\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 1\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"OriginalFileName\\\\\\\">\\\" OriginalFileName \\\"</Data>\\\" * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(OriginalFileName) //Performance tweak\\r\\n|where Hashes has_any {SHA256_IOC}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend SHA256_Hash = tostring(Hashes.SHA256) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(SHA256_Hash), OriginalFileName=make_set(OriginalFileName), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , OriginalFileName = tostring(strcat_array(OriginalFileName,\\\", \\\"))\\r\\n|project count_ ,OriginalFileName ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 1 - SHA256_Hash - SHA256 (Child Process)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 1 - SHA256_Hash - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 1\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"OriginalFileName\\\\\\\">\\\" OriginalFileName \\\"</Data>\\\" * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(OriginalFileName) //Performance tweak\\r\\n|where Hashes has_any {IMPHASH}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend IMPHASH_Hash = tostring(Hashes.IMPHASH) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(IMPHASH_Hash), OriginalFileName=make_set(OriginalFileName), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , OriginalFileName = tostring(strcat_array(OriginalFileName,\\\", \\\"))\\r\\n|project count_ ,OriginalFileName ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 1 - IMPHASH_Hash - IMPHASH (Child Process)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 1 - IMPHASH_Hash - IMPHASH\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 6\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes) //Performance tweak\\r\\n|where Hashes has_any {SHA256_IOC}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend SHA256_Hash = tostring(Hashes.SHA256) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(SHA256_Hash), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) \\r\\n|project count_ , IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 6 - SHA256_Hash - SHA256 (Driver Loaded)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 6 - SHA256_Hash - SHA256 \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 6\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes) //Performance tweak\\r\\n|where Hashes has_any {IMPHASH}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend IMPHASH_Hash = tostring(Hashes.IMPHASH) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(IMPHASH_Hash), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) \\r\\n|project  count_ , IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 6 - IMPHASH_Hash - IMPHASH (Driver Loaded)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 6 - IMPHASH_Hash - IMPHASH \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 7\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"OriginalFileName\\\\\\\">\\\" OriginalFileName \\\"</Data>\\\" * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(OriginalFileName) //Performance tweak\\r\\n|where Hashes has_any {SHA256_IOC}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend SHA256_Hash = tostring(Hashes.SHA256) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(SHA256_Hash), OriginalFileName=make_set(OriginalFileName), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , OriginalFileName = tostring(strcat_array(OriginalFileName,\\\", \\\"))\\r\\n|project count_ ,OriginalFileName ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 7 - SHA256_Hash - SHA256 (Image Loaded)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 7 - SHA256_Hash - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 7\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"OriginalFileName\\\\\\\">\\\" OriginalFileName \\\"</Data>\\\" * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" *\\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(OriginalFileName) //Performance tweak\\r\\n|where Hashes has_any {IMPHASH}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend IMPHASH_Hash = tostring(Hashes.IMPHASH) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(IMPHASH_Hash), OriginalFileName=make_set(OriginalFileName), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , OriginalFileName = tostring(strcat_array(OriginalFileName,\\\", \\\"))\\r\\n|project count_ ,OriginalFileName ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 7 - IMPHASH_Hash - IMPHASH (Image Loaded)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 7 - IMPHASH_Hash - IMPHASH \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 15\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"TargetFilename\\\\\\\">\\\" TargetFilename \\\"</Data>\\\" * \\\"\\\\\\\"Hash\\\\\\\">\\\" Hashes \\\"</Data>\\\" * \\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(TargetFilename) //Performance tweak\\r\\n|where Hashes has_any {SHA256_IOC}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend SHA256_Hash = tostring(Hashes.SHA256) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(SHA256_Hash), TargetFilename=make_set(TargetFilename), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , TargetFilename = tostring(strcat_array(TargetFilename,\\\", \\\"))\\r\\n|project count_ ,TargetFilename ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 15 - SHA256_Hash - SHA256 (FileCreateStreamHash)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 15 - SHA256_Hash - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Event\\r\\n|where Source =~ \\\"Microsoft-Windows-sysmon\\\" //Workaround since Sentinel Workbooks encounter conflict with target workspace when the searches contains the word 'Sysm0n'\\r\\n|where EventID == 26\\r\\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription, TenantId\\r\\n|parse EventData with * \\\"\\\\\\\"TargetFilename\\\\\\\">\\\" TargetFilename \\\"</Data>\\\" * \\\"\\\\\\\"Hashes\\\\\\\">\\\" Hashes \\\"</Data>\\\" * \\r\\n|summarize count() by TenantId, tostring(Hashes), tostring(TargetFilename) //Performance tweak\\r\\n|where Hashes has_any {SHA256_IOC}\\r\\n// Hashes parse section --START\\r\\n|extend Hashes = extract_all(@\\\"(?P<key>\\\\w+)=(?P<value>[a-zA-Z0-9]+)\\\", dynamic([\\\"key\\\",\\\"value\\\"]), tostring(Hashes)) //Transform Hashes field into dynamics format\\r\\n|mv-apply todynamic(Hashes) on (summarize Hashes = make_bag(pack(tostring(Hashes[0]), tostring(Hashes[1])))) //Address inconsistency on hashes used on different agencies\\r\\n|extend SHA256_Hash = tostring(Hashes.SHA256) //Grab only Hash 256\\r\\n// Hashes parse section --END\\r\\n|summarize IOC=make_set(SHA256_Hash), TargetFilename=make_set(TargetFilename), count_=sum(count_) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")) , TargetFilename = tostring(strcat_array(TargetFilename,\\\", \\\"))\\r\\n|project count_ ,TargetFilename ,IOC\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"Sysmon - 26 - SHA256_Hash - SHA256 (FileDeleteDetected)\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"Sysmon - 26 - SHA256_Hash - SHA256\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Endpoint\"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n|where InitiatingProcessSHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(InitiatingProcessSHA256), InitiatingProcessFileName=make_set(InitiatingProcessFileName),count_=count(InitiatingProcessSHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend InitiatingProcessFileName = tostring(strcat_array(InitiatingProcessFileName,\\\", \\\"))\\r\\n|project IOC,InitiatingProcessFileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - InitiatingProcessSHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"InitiatingProcessFileName\",\"label\":\"Process Name\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceEvents - InitiatingProcessSHA256 - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\r\\n|where SHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(SHA256), FileName=make_set(FileName), count_=count(SHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC,FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceEvents - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\r\\n|where InitiatingProcessSHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(InitiatingProcessSHA256),InitiatingProcessFileName=make_set(InitiatingProcessFileName), count_=count(InitiatingProcessSHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend InitiatingProcessFileName = tostring(strcat_array(InitiatingProcessFileName,\\\", \\\"))\\r\\n|project IOC,InitiatingProcessFileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - InitiatingProcessSHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"InitiatingProcessFileName\",\"label\":\"Process Name\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileEvents - InitiatingProcessSHA256 - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\r\\n|where SHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(SHA256), FileName=make_set(FileName),count_=count(SHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC, FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileEvents - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileCertificateInfo\\r\\n|where SHA1 has_any {SHA1_IOC}\\r\\n|summarize IOC=make_set(SHA1), Issuer = make_set(Issuer), count_=count(SHA1) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend Issuer = tostring(strcat_array(Issuer,\\\", \\\"))\\r\\n|project IOC, Issuer, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileCertificateInfo - SHA1\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileCertificateInfo - SHA1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailAttachmentInfo\\r\\n|where SHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(SHA256), FileName=make_set(FileName), count_=count(SHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC,FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - EmailAttachmentInfo - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - EmailAttachmentInfo - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceImageLoadEvents\\r\\n|where InitiatingProcessSHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(InitiatingProcessSHA256),InitiatingProcessFileName=make_set(InitiatingProcessFileName), count_=count(InitiatingProcessSHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend InitiatingProcessFileName = tostring(strcat_array(InitiatingProcessFileName,\\\", \\\"))\\r\\n|project IOC, InitiatingProcessFileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceImageLoadEvents - InitiatingProcessSHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"InitiatingProcessFileName\",\"label\":\"Process Name\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceImageLoadEvents - InitiatingProcessSHA256 - SHA256 \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceImageLoadEvents\\r\\n|where SHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(SHA256), FileName=make_set(FileName), count_=count(SHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC, FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceImageLoadEvents - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceImageLoadEvents - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\r\\n|where InitiatingProcessSHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(InitiatingProcessSHA256), InitiatingProcessFileName=make_set(InitiatingProcessFileName), count_=count(InitiatingProcessSHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend InitiatingProcessFileName = tostring(strcat_array(InitiatingProcessFileName,\\\", \\\"))\\r\\n|project IOC, InitiatingProcessFileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceProcessEvents - InitiatingProcessSHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"InitiatingProcessFileName\",\"label\":\"Process Name\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceProcessEvents- InitiatingProcessSHA256 - SHA256\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\r\\n|where SHA256 has_any {SHA256_IOC}\\r\\n|summarize IOC=make_set(SHA256),FileName=make_set(FileName), count_=count(SHA256) by TenantId\\r\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\r\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\r\\n|project IOC,FileName, count_\\r\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceProcessEvents - SHA256\",\"noDataMessage\":\"No IOC Found\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceProcessEvents - SHA256\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"filehash\"},\"name\":\"file-hash\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e40fc7ee-23fb-4339-8fa8-a7fe07592f79\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URL_IOC\",\"type\":1,\"description\":\"Put multiple URL in the following array format (\\\"url.com/main.php\\\", \\\"url2.com/menu.php\\\")\",\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\",\"multiLineHeight\":4},\"timeContext\":{\"durationMs\":86400000},\"value\":\"(\\\"emirjk.ru\\\",\\\"google.com\\\")\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":1,\"content\":{\"json\":\"## Security Alert - URL\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n|summarize arg_max(TimeGenerated,*) by SystemAlertId\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\n| mv-expand Entities\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\n| extend Entity_Name = columnifexists(\\\"Entity_Name\\\", \\\"\\\")\\n| extend Entity_ResourceId = columnifexists(\\\"Entity_ResourceId\\\", \\\"\\\")\\n| extend Entity_Directory = columnifexists(\\\"Entity_Directory\\\", \\\"\\\")\\n| extend Entity_Value = columnifexists(\\\"Entity_Value\\\", \\\"\\\")\\n| extend Entity_HostName = columnifexists(\\\"Entity_HostName\\\", \\\"\\\")\\n| extend Entity_Address = columnifexists(\\\"Entity_Address\\\", \\\"\\\")\\n| extend Entity_ProcessId = columnifexists(\\\"Entity_ProcessId\\\", \\\"\\\")\\n| extend Entity_Url = columnifexists(\\\"Entity_Url\\\", \\\"\\\")\\n| extend Target = iif(Entity_Type == \\\"account\\\", Entity_Name, iif(Entity_Type == \\\"azure-resource\\\", Entity_ResourceId, iif(Entity_Type == \\\"cloud-application\\\", Entity_Name, iif(Entity_Type == \\\"dns\\\", Entity_Name, iif(Entity_Type == \\\"file\\\", strcat(Entity_Directory, \\\"\\\\\\\\\\\", Entity_Name), iif(Entity_Type == \\\"filehash\\\", Entity_Value, iif(Entity_Type == \\\"host\\\", Entity_HostName, iif(Entity_Type == \\\"ip\\\" , Entity_Address, iif(Entity_Type == \\\"malware\\\", Entity_HostName, iif(Entity_Type == \\\"network-connection\\\", Entity_Name, iif(Entity_Type == \\\"process\\\", Entity_ProcessId, iif(Entity_Type == \\\"registry-key\\\", Entity_Name, iif(Entity_Type == \\\"registry-value\\\", Entity_Name, iif(Entity_Type == \\\"security-group\\\", Entity_Name, iif(Entity_Type == \\\"url\\\", Entity_Url, \\\"NoTarget\\\")))))))))))))))\\n|where Entity_Type == \\\"url\\\"\\n|where Target has_any {URL_IOC}\\n|summarize IOC=make_set(Target), AlertName=make_set(AlertName),SystemAlertId=make_set(SystemAlertId) ,count_=count(Target) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend AlertName = tostring(strcat_array(AlertName,\\\", \\\")), SystemAlertId = tostring(strcat_array(SystemAlertId,\\\", \\\"))\\n|project AlertName, SystemAlertId, count_ ,IOC\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityAlert - URL\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"SecurityAlert - URL\"},{\"type\":1,\"content\":{\"json\":\"## CommonSecurityLog\"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\n|where TimeGenerated {TimeRange:query}\\n|where RequestURL has_any {URL_IOC}\\n|summarize IOC=make_set(RequestURL), count_=count(RequestURL) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|project count_ ,IOC\\n|sort by count_ desc\",\"size\":1,\"title\":\"CommonSecurityLog - RequestURL\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"query - 5\"},{\"type\":1,\"content\":{\"json\":\"## DNS\"},\"name\":\"text - 25\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DnsEvents\\n|where SubType == \\\"LookupQuery\\\"\\n|where TimeGenerated {TimeRange:query}\\n|where Name has_any {URL_IOC}\\n|summarize IOC=make_set(Name), count_=count(Name) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|project count_ ,IOC\\n|sort by count_ desc\",\"size\":1,\"title\":\"DNS - DnsEvents\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"DNS - DnsEvents\"},{\"type\":1,\"content\":{\"json\":\"## Office 365\"},\"name\":\"text - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OfficeActivity\\n|where TimeGenerated {TimeRange:query}\\n|where OfficeObjectId has_any {URL_IOC}\\n|summarize IOC=make_set(OfficeObjectId),Type_=make_set(OfficeWorkload, 100000), count_=count(OfficeObjectId) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend Type_ = tostring(strcat_array(Type_,\\\", \\\"))\\n|project count_ ,IOC,Type_\\n|sort by count_ desc\",\"size\":1,\"title\":\"OfficeActivity - OfficeObjectId\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OfficeActivity\\n|where TimeGenerated {TimeRange:query}\\n|where Site_Url has_any {URL_IOC}\\n|summarize IOC=make_set(Site_Url),Type_=make_set(OfficeWorkload, 100000), count_=count(Site_Url) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend Type_ = tostring(strcat_array(Type_,\\\", \\\"))\\n|project count_ ,IOC,Type_\\n|sort by count_ desc\",\"size\":1,\"title\":\"OfficeActivity - Site_Url\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"},{\"columnId\":\"Type_\",\"label\":\"Type\"}]}},\"customWidth\":\"50\",\"name\":\"OfficeActivity - Site_Url\"},{\"type\":1,\"content\":{\"json\":\"## Security Event\"},\"name\":\"text - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityEvent\\n|where CommandLine has_any {URL_IOC}\\n|summarize IOC=make_set(CommandLine),EventID=make_set(EventID), count_=count(CommandLine) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend EventID = tostring(strcat_array(EventID,\\\", \\\"))\\n|project EventID, IOC, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"SecurityEvent - CommandLine\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"SecurityEvent - CommandLine\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Endpoint\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\n|where FileOriginUrl has_any {URL_IOC}\\n|summarize FileName=make_set(FileName), IOC=make_set(FileOriginUrl), count_=count(FileOriginUrl) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|project FileName, IOC, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - FileOriginUrl\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"FileName\",\"label\":\"File Name\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceEvents - FileOriginUrl\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceEvents\\n|where RemoteUrl has_any {URL_IOC}\\n|summarize InitiatingProcessFileName=make_set(InitiatingProcessFileName), IOC=make_set(RemoteUrl), count_=count(RemoteUrl) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), InitiatingProcessFileName = tostring(strcat_array(InitiatingProcessFileName,\\\", \\\"))\\n|project InitiatingProcessFileName, IOC, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceEvents - RemoteUrl\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"InitiatingProcessFileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"InitiatingProcessFileName\",\"label\":\"Initiating Process FileName\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceEvents - RemoteUrl-2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\n|where FileOriginUrl has_any {URL_IOC}\\n|summarize IOC=make_set(FileOriginUrl),FileName=make_set(FileName), count_=count(FileOriginUrl) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\n|project IOC, FileName, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - FileOriginUrl\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileEvents - FileOriginUrl\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileEvents\\n|where FileOriginReferrerUrl has_any {URL_IOC}\\n|summarize IOC=make_set(FileOriginReferrerUrl),FileName=make_set(FileName), count_=count(FileOriginReferrerUrl) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\n|project IOC, FileName, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileEvents - FileOriginReferrerUrl\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileEvents - FileOriginReferrerUrl\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\n|where InitiatingProcessCommandLine has_any {URL_IOC}\\n|summarize IOC=make_set(InitiatingProcessCommandLine),FileName=make_set(FileName), count_=count(InitiatingProcessCommandLine) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\n|project IOC, FileName, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceProcessEvents - InitiatingProcessCommandLine\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceProcessEvents - InitiatingProcessCommandLine\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceProcessEvents\\n|where ProcessCommandLine has_any {URL_IOC}\\n|summarize IOC=make_set(ProcessCommandLine),FileName=make_set(FileName), count_=count(ProcessCommandLine) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\n|project IOC, FileName, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceProcessEvents - ProcessCommandLine\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceProcessEvents - ProcessCommandLine\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceImageLoadEvents\\n|where InitiatingProcessCommandLine has_any {URL_IOC}\\n|summarize IOC=make_set(InitiatingProcessCommandLine),FileName=make_set(FileName), count_=count(InitiatingProcessCommandLine) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend FileName = tostring(strcat_array(FileName,\\\", \\\"))\\n|project IOC, FileName, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceImageLoadEvents - InitiatingProcessCommandLine\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceImageLoadEvents - InitiatingProcessCommandLine\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceRegistryEvents\\n|where RegistryValueData has_any {URL_IOC}\\n|summarize IOC=make_set(RegistryValueData),ActionType=make_set(ActionType), count_=count(RegistryValueData) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend ActionType = tostring(strcat_array(ActionType,\\\", \\\"))\\n|project IOC, ActionType, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceRegistryEvents - RegistryValueData\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}},{\"columnMatch\":\"FileName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceRegistryEvents - RegistryValueData\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceFileCertificateInfo\\n|where CrlDistributionPointUrls has_any {URL_IOC}\\n|summarize IOC=make_set(CrlDistributionPointUrls), count_=count(CrlDistributionPointUrls) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|project IOC, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceFileCertificateInfo - CrlDistributionPointUrls\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceFileCertificateInfo - CrlDistributionPointUrls\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"DeviceNetworkEvents\\n|where RemoteUrl has_any {URL_IOC}\\n|summarize IOC=make_set(RemoteUrl), count_=count(RemoteUrl) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|project IOC, count_\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDE - DeviceNetworkEvents - RemoteUrl\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40%\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"MSDE - DeviceNetworkEvents - RemoteUrl\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Office 365\"},\"name\":\"text - 18\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"65985eea-0c6b-412a-bdda-29533e73c7b4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DeliveryAction\",\"label\":\"Delivery Action\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\n    { \\\"value\\\":\\\"Delivered\\\", \\\"label\\\":\\\"Delivered\\\"},\\n    { \\\"value\\\":\\\"Blocked\\\", \\\"label\\\":\\\"Blocked\\\" },\\n    { \\\"value\\\":\\\"Junked\\\", \\\"label\\\":\\\"Junked\\\"},\\n    { \\\"value\\\":\\\"Unknown\\\", \\\"label\\\":\\\"Unknown\\\"}\\n]\",\"timeContext\":{\"durationMs\":14400000},\"defaultValue\":\"value::all\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"name\":\"parameters - 24\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailUrlInfo\\n|where TimeGenerated {TimeRange:value}\\n|where Url has_any {URL_IOC}\\n|join kind=inner\\n(\\nEmailEvents\\n|where TimeGenerated {TimeRange:value}\\n| where DeliveryAction in ({DeliveryAction:value})\\n) on NetworkMessageId\\n|summarize IOC=make_set(Url), count_=count(Url), Recipient=make_set(RecipientEmailAddress) , Sender=make_set(SenderMailFromAddress), EmailSubject=make_set(Subject), DeliveryAction=make_set(DeliveryAction) ,FirstEvent= min(TimeGenerated), LastEvent=max(TimeGenerated)   by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Recipient = tostring(strcat_array(Recipient,\\\", \\\")), Sender = tostring(strcat_array(Sender,\\\", \\\")), EmailSubject = tostring(strcat_array(EmailSubject,\\\", \\\")), DeliveryAction = tostring(strcat_array(DeliveryAction,\\\", \\\"))\\n|project IOC, count_, FirstEvent, LastEvent, DeliveryAction ,Recipient, Sender, EmailSubject\\n|sort by count_ desc\",\"size\":0,\"title\":\"MSDO365 - EmailUrlInfo - Url\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"},{\"columnId\":\"DeliveryAction\",\"label\":\"Delivery Action\"},{\"columnId\":\"EmailSubject\",\"label\":\"Email Subject\"}]}},\"name\":\"MSDO365 - EmailUrlInfo - Url\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"UrlClickEvents\\n|where TimeGenerated {TimeRange:value}\\n|where Url has_any {URL_IOC}\\n|join kind=leftouter\\n(\\nEmailEvents\\n|where TimeGenerated {TimeRange:value}\\n) on NetworkMessageId\\n|summarize IOC=make_set(Url), count_=count(Url), ActionType=make_set(ActionType), Account=make_set(AccountUpn), FirstEvent= min(TimeGenerated), LastEvent=max(TimeGenerated) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")), ActionType = tostring(strcat_array(ActionType,\\\", \\\")), Account = tostring(strcat_array(Account,\\\", \\\"))\\n|project IOC, count_, ActionType, Account, FirstEvent, LastEvent\\n|sort by count_ desc\",\"size\":1,\"title\":\"MSDO365 - UrlClickEvents - Url\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"MSDO365 - UrlClickEvents - Url\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"url\"},\"name\":\"url\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"loadType\":\"always\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a66098f8-6aa0-4439-9c84-e7be5831649a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EMAIL_IOC\",\"label\":\"Email Address\",\"type\":1,\"description\":\"Recommend to only add 1 email IOC for deeper analysis\",\"isRequired\":true,\"typeSettings\":{\"multiLineText\":true,\"editorLanguage\":\"text\",\"multiLineHeight\":2},\"timeContext\":{\"durationMs\":86400000},\"value\":\"(\\\"sample@google.com\\\")\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":1,\"content\":{\"json\":\"## Overview of General Information on Email Deliverability\"},\"name\":\"text - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| where EmailDirection == \\\"Inbound\\\"\\n| summarize count() by DeliveryAction\",\"size\":0,\"title\":\"Email Inbound Deliverability in the {TimeRange:label}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"DeliveryAction\",\"createOtherGroup\":null,\"seriesLabelSettings\":[{\"seriesName\":\"Blocked\",\"color\":\"green\"},{\"seriesName\":\"Delivered\",\"color\":\"redBright\"},{\"seriesName\":\"Junked\",\"color\":\"orange\"},{\"color\":\"gray\"}]}},\"customWidth\":\"20\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| where EmailDirection == \\\"Inbound\\\"\\n| where DeliveryAction == \\\"Delivered\\\"\\n| summarize count() by DeliveryLocation\",\"size\":0,\"title\":\"Email inbound deliverability by Location in the {TimeRange:label}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Blocked\",\"color\":\"green\"},{\"seriesName\":\"Delivered\",\"color\":\"redBright\"}]}},\"customWidth\":\"20\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where TimeGenerated {TimeRange:value}\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| where EmailDirection == \\\"Inbound\\\"\\n| where DeliveryAction == \\\"Delivered\\\"\\n| project NetworkMessageId, DeliveryAction, DeliveryLocation, SenderFromAddress, SenderMailFromAddress, RecipientEmailAddress, Subject, SenderIPv4, EmailDirection, TenantId\\n| join kind=leftouter\\n(\\nEmailPostDeliveryEvents\\n| where TimeGenerated {TimeRange:value}\\n| summarize arg_max(TimeGenerated,*) by NetworkMessageId\\n| extend \\n    DeliveryLocation_Post = DeliveryLocation, //Differentiate with original location\\n    TenantId_Post = TenantId //Differentiate with original location\\n) on NetworkMessageId, RecipientEmailAddress\\n| extend \\n    Action = iff(isempty(Action), \\\"No Action\\\", Action),\\n    ActionResult = iff(isempty(ActionResult), \\\"No Result\\\",ActionResult),\\n    ActionTrigger = iff(isempty(ActionTrigger), \\\"No Trigger\\\",ActionTrigger),\\n    ActionType = iff(isempty(ActionType), \\\"No Action\\\",ActionType),\\n    final_DeliveryLocation = iff(isempty(DeliveryLocation_Post), \\n                                iff(ActionType contains \\\"ZAP\\\", ActionType, DeliveryLocation),\\n                                    DeliveryLocation_Post) //Find a final location of the email\\n| evaluate pivot(final_DeliveryLocation,count(RecipientEmailAddress),DeliveryLocation)\",\"size\":0,\"title\":\"Original Email Location vs. Final Email Location in the {TimeRange:label}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Phish ZAP\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Delete\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Inbox/folder\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"3\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Junk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\">=\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}}],\"labelSettings\":[{\"columnId\":\"DeliveryLocation\",\"label\":\"Original Location\"}]}},\"customWidth\":\"30\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where TimeGenerated {TimeRange:value}\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| where EmailDirection == \\\"Inbound\\\"\\n| where DeliveryAction == \\\"Delivered\\\"\\n| project NetworkMessageId, DeliveryAction, DeliveryLocation, SenderFromAddress, SenderMailFromAddress, RecipientEmailAddress, Subject, SenderIPv4, EmailDirection, TenantId\\n| join kind=leftouter\\n(\\nEmailPostDeliveryEvents\\n| where TimeGenerated {TimeRange:value}\\n| summarize arg_max(TimeGenerated,*) by NetworkMessageId\\n| extend \\n    DeliveryLocation_Post = DeliveryLocation, //Differentiate with original location\\n    TenantId_Post = TenantId //Differentiate with original location\\n) on NetworkMessageId, RecipientEmailAddress\\n| extend \\n    Action = iff(isempty(Action), \\\"No Action\\\", Action),\\n    ActionResult = iff(isempty(ActionResult), \\\"No Result\\\",ActionResult),\\n    ActionTrigger = iff(isempty(ActionTrigger), \\\"No Trigger\\\",ActionTrigger),\\n    ActionType = iff(isempty(ActionType), \\\"No Action\\\",ActionType),\\n    final_DeliveryLocation = iff(isempty(DeliveryLocation_Post), \\n                                iff(ActionType contains \\\"ZAP\\\", ActionType, DeliveryLocation),\\n                                    DeliveryLocation_Post) //Find a final location of the email\\n| evaluate pivot(final_DeliveryLocation,count(RecipientEmailAddress),TenantId)\",\"size\":0,\"title\":\"Email final location by Agency in the {TimeRange:label}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Phish ZAP\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Delete\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Inbox/folder\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Junk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"1\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"text\":\"{0}{1}\"}]}}]}},\"customWidth\":\"30\",\"name\":\"query - 13\"},{\"type\":1,\"content\":{\"json\":\"## Security Alert - mailMessage\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert\\n|summarize arg_max(TimeGenerated,*) by SystemAlertId\\n| extend Entities = iff(isempty(Entities), todynamic('[{\\\"dummy\\\" : \\\"\\\"}]'), todynamic(Entities))\\n| mv-expand Entities\\n| evaluate bag_unpack(Entities, \\\"Entity_\\\")\\n| extend Entity_Type = columnifexists(\\\"Entity_Type\\\", \\\"\\\")\\n| extend Entity_Name = columnifexists(\\\"Entity_Name\\\", \\\"\\\")\\n| extend Entity_ResourceId = columnifexists(\\\"Entity_ResourceId\\\", \\\"\\\")\\n| extend Entity_Directory = columnifexists(\\\"Entity_Directory\\\", \\\"\\\")\\n| extend Entity_Value = columnifexists(\\\"Entity_Value\\\", \\\"\\\")\\n| extend Entity_HostName = columnifexists(\\\"Entity_HostName\\\", \\\"\\\")\\n| extend Entity_Address = columnifexists(\\\"Entity_Address\\\", \\\"\\\")\\n| extend Entity_ProcessId = columnifexists(\\\"Entity_ProcessId\\\", \\\"\\\")\\n| extend Entity_Url = columnifexists(\\\"Entity_Url\\\", \\\"\\\")\\n| extend Entity_Sender = columnifexists(\\\"Entity_Sender\\\", \\\"\\\")\\n| extend Target = iif(Entity_Type == \\\"account\\\", Entity_Name, iif(Entity_Type == \\\"azure-resource\\\", Entity_ResourceId, iif(Entity_Type == \\\"cloud-application\\\", Entity_Name, iif(Entity_Type == \\\"dns\\\", Entity_Name, iif(Entity_Type == \\\"file\\\", strcat(Entity_Directory, \\\"\\\\\\\\\\\", Entity_Name), iif(Entity_Type == \\\"filehash\\\", Entity_Value, iif(Entity_Type == \\\"host\\\", Entity_HostName, iif(Entity_Type == \\\"ip\\\" , Entity_Address, iif(Entity_Type == \\\"malware\\\", Entity_HostName, iif(Entity_Type == \\\"network-connection\\\", Entity_Name, iif(Entity_Type == \\\"process\\\", Entity_ProcessId, iif(Entity_Type == \\\"registry-key\\\", Entity_Name, iif(Entity_Type == \\\"registry-value\\\", Entity_Name, iif(Entity_Type == \\\"mailMessage\\\", Entity_Sender, iif(Entity_Type == \\\"security-group\\\", Entity_Name, iif(Entity_Type == \\\"url\\\", Entity_Url, \\\"NoTarget\\\"))))))))))))))))\\n|where Entity_Type == \\\"mailMessage\\\"\\n|where Target has_any {EMAIL_IOC}\\n|summarize IOC=make_set(Target), AlertName=make_set(AlertName),SystemAlertId=make_set(SystemAlertId) ,count_=count(Target), LatestTimestamp=max(TimeGenerated) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\"))\\n|extend AlertName = tostring(strcat_array(AlertName,\\\", \\\")), SystemAlertId = tostring(strcat_array(SystemAlertId,\\\", \\\"))\\n|project AlertName, SystemAlertId, LatestTimestamp, count_ ,IOC\\n|sort by LatestTimestamp desc\",\"size\":1,\"title\":\"Security Alert - mailMessage - Entity_Sender\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25%\"}},{\"columnMatch\":\"IOC\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25%\"}}],\"sortBy\":[{\"itemKey\":\"LatestTimestamp\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"LatestTimestamp\",\"label\":\"Latest Timestamp\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"sortBy\":[{\"itemKey\":\"LatestTimestamp\",\"sortOrder\":2}]},\"name\":\"Security Alert - mailMessage - Entity_Sender\"},{\"type\":1,\"content\":{\"json\":\"## Microsoft Defender for Office 365\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let time_step = {TimeRange:grain};\\nEmailEvents\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| extend IOC = SenderMailFromAddress\\n| make-series Email_Trend = count() default=0 on TimeGenerated in range({TimeRange:start}+time_step,{TimeRange:end}-time_step,time_step) by IOC\",\"size\":1,\"title\":\"EmailEvents - SenderMailFromAddress - Cross-sector overview\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\"},\"name\":\"EmailEvents - SenderMailFromAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where TimeGenerated {TimeRange:value}\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| join kind=leftouter \\n( \\nEmailPostDeliveryEvents\\n| where TimeGenerated {TimeRange:value}\\n| summarize arg_max(TimeGenerated,*) by NetworkMessageId\\n| extend \\n    DeliveryLocation_Post = DeliveryLocation, //Differentiate with original location\\n    TenantId_Post = TenantId\\n) on NetworkMessageId, RecipientEmailAddress\\n| extend \\n    Action = iff(isempty(Action), \\\"No Action\\\", Action),\\n    ActionResult = iff(isempty(ActionResult), \\\"No Result\\\",ActionResult),\\n    ActionTrigger = iff(isempty(ActionTrigger), \\\"No Trigger\\\",ActionTrigger),\\n    ActionType = iff(isempty(ActionType), \\\"No Action\\\",ActionType),\\n    final_DeliveryLocation = iff(isempty(DeliveryLocation_Post), DeliveryLocation,DeliveryLocation_Post) //Find a final location of the email\\n| summarize IOC=make_set(SenderMailFromAddress), count_=count(SenderMailFromAddress) ,Recipient=make_set(RecipientEmailAddress), EmailSubject=make_set(Subject), DeliveryAction=make_set(DeliveryAction) ,FirstEvent= min(TimeGenerated), LastEvent=max(TimeGenerated) , final_DeliveryLocation=make_set(final_DeliveryLocation)  by TenantId\\n| extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Recipient = tostring(strcat_array(Recipient,\\\", \\\")), EmailSubject = tostring(strcat_array(EmailSubject,\\\", \\\")), DeliveryAction = tostring(strcat_array(DeliveryAction,\\\", \\\")), final_DeliveryLocation = tostring(strcat_array(final_DeliveryLocation,\\\", \\\"))\\n| project FirstEvent, LastEvent, IOC, count_, Recipient, EmailSubject, DeliveryAction, final_DeliveryLocation\\n| sort by count_ desc\",\"size\":0,\"title\":\"EmailEvents - SenderMailFromAddress + EmailPostDeliveryAction\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Recipient\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30%\"}},{\"columnMatch\":\"EmailSubject\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20%\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"FirstEvent\",\"label\":\"First Event\"},{\"columnId\":\"LastEvent\",\"label\":\"Last Event\"},{\"columnId\":\"count_\",\"label\":\"Count\"},{\"columnId\":\"EmailSubject\",\"label\":\"Email Subject\"},{\"columnId\":\"DeliveryAction\",\"label\":\"Delivery Action\"},{\"columnId\":\"final_DeliveryLocation\",\"label\":\"Final Delivery Location\"}]}},\"name\":\"EmailEvents - SenderMailFromAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n| where TimeGenerated {TimeRange:value}\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| project TimeGenerated, DeliveryAction, DeliveryLocation, SenderMailFromAddress, RecipientEmailAddress, Subject, NetworkMessageId\\n| join kind=inner \\n(\\nUrlClickEvents\\n| where TimeGenerated {TimeRange:value}\\n) on NetworkMessageId\\n| summarize IOC=make_set(SenderMailFromAddress) ,count_=count(SenderMailFromAddress), Recipient=make_set(RecipientEmailAddress), EmailSubject=make_set(Subject), DeliveryAction=make_set(DeliveryAction), DeliveryLocation=make_set(DeliveryLocation) , UserClick = make_set(AccountUpn) ,FirstEvent= min(TimeGenerated), LastEvent=max(TimeGenerated), Url=make_set(Url) by TenantId\\n| extend IOC = tostring(strcat_array(IOC,\\\", \\\")), Recipient = tostring(strcat_array(Recipient,\\\", \\\")), EmailSubject = tostring(strcat_array(EmailSubject,\\\", \\\")), DeliveryAction = tostring(strcat_array(DeliveryAction,\\\", \\\")), DeliveryLocation = tostring(strcat_array(DeliveryLocation,\\\", \\\")), Url = tostring(strcat_array(Url,\\\", \\\")), UserClick = tostring(strcat_array(UserClick,\\\", \\\"))\\n|project FirstEvent, LastEvent, IOC, count_, Recipient, UserClick, EmailSubject, DeliveryAction, DeliveryLocation, Url\\n|sort by count_ desc\\n\",\"size\":0,\"title\":\"UrlClickEvents - Click Events from email sent by Sender\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserClick\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20%\"}}],\"labelSettings\":[{\"columnId\":\"IOC\",\"label\":\"IOC (Email Sender)\"},{\"columnId\":\"count_\",\"label\":\"Count\"},{\"columnId\":\"UserClick\",\"label\":\"User Clicking the Link\"}]},\"sortBy\":[]},\"name\":\"UrlClickEvents - NetworkMessageId\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let time_step = {TimeRange:grain};\\nEmailEvents\\n| where SenderMailFromAddress has_any {EMAIL_IOC} or SenderFromAddress has_any {EMAIL_IOC} //Must use both P1 P2 column names\\n| extend IOC = RecipientEmailAddress\\n| make-series Email_Trend = count() default=0 on TimeGenerated in range({TimeRange:start}+time_step,{TimeRange:end}-time_step,time_step) by IOC\",\"size\":1,\"title\":\"EmailEvents - RecipientEmailAddress - Outbound email interaction with IOCS - Cross-sector overview\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\"},\"name\":\"EmailEvents - RecipientEmailAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"EmailEvents\\n|where RecipientEmailAddress has_any {EMAIL_IOC}\\n|summarize IOC=make_set(RecipientEmailAddress), count_=count(RecipientEmailAddress) ,Sender=make_set(SenderMailFromAddress) ,Recipient=make_set(RecipientEmailAddress), EmailSubject=make_set(Subject), DeliveryAction=make_set(DeliveryAction) ,FirstEvent= min(TimeGenerated), LastEvent=max(TimeGenerated) by TenantId\\n|extend IOC = tostring(strcat_array(IOC,\\\", \\\")),Sender = tostring(strcat_array(Sender,\\\", \\\")), Recipient = tostring(strcat_array(Recipient,\\\", \\\")), EmailSubject = tostring(strcat_array(EmailSubject,\\\", \\\")), DeliveryAction = tostring(strcat_array(DeliveryAction,\\\", \\\"))\\n|project FirstEvent, LastEvent, IOC, count_, Sender, Recipient, EmailSubject, DeliveryAction\\n|sort by count_ desc\",\"size\":0,\"title\":\"EmailEvents - RecipientEmailAddress - User outbound email interaction with IOCs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"EmailEvents - RecipientEmailAddress\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"email_external\"},\"name\":\"email_external\"}],\"isLocked\":false,\"fallbackResourceIds\":[],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
        "version": "1.0",
        "sourceId": "[variables('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}