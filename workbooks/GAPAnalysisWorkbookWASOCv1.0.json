{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "GAP Analysis Workbook WASOC-v1.0",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "WorkspaceName": {
        "type": "string",
        "defaultValue": "<Add log analytics workspace name>",
        "minLength": 1,
        "metadata": {
            "description": "The name of the Log Analytics workspace to which this workbook will be associated"
        }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
"variables": {
	"workbookSourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('WorkspaceName'))]"
    	},
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
      "displayName": "[parameters('workbookDisplayName')]",
      "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"85c3e11e-0568-4c21-8c6f-668f10b85231\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"label\":\"Resource groups\",\"type\":6,\"isRequired\":true,\"query\":\"Resources\\r\\n| where type in~ ({ResourceTypes})\\r\\n| summarize Count = count() by subscriptionId, resourceGroup\\r\\n| order by Count desc\\r\\n| extend Rank = row_number()\\r\\n| project value = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), label = resourceGroup, selected = false\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"67c2ce6e-ea54-4ae4-8343-3fcad8e53d1b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains 'SecurityInsights' | project id = tostring(properties.workspaceResourceId)\",\"crossComponentResources\":[\"value::all\"],\"value\":[\"value::all\"],\"typeSettings\":{\"limitSelectTo\":100,\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"04951277-d010-499c-8e9c-1967c08836b2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":14400000},\"value\":{\"durationMs\":300000}},{\"id\":\"b77e834f-4e65-4d13-989a-d7522ced27e1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Instructions\",\"label\":\"Show Instructions\",\"type\":10,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\n    { \\\"value\\\":\\\"Hide\\\", \\\"label\\\":\\\"Hide\\\",\\\"selected\\\":true},\\n    { \\\"value\\\":\\\"Show\\\", \\\"label\\\":\\\"Show\\\" }\\n]\",\"timeContext\":{\"durationMs\":14400000},\"value\":\"Show\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 3\"},{\"type\":1,\"content\":{\"json\":\"This workbook contains various queries to help in performing a Sentinel GAP Analysis. It covers the following: \\n- Data Visibility - Recommended logs that are synched to Sentinel\\n- Noisy Alerts - Top firing alerts that have not been closed as True Positive\\n- Log Ingestion - A summary of data ingestions by volume. \\n<br><br>\\nFor more details refer to the [WA SOC Microsoft Sentinel Guidance](https://soc.cyber.wa.gov.au/onboarding/sentinel-guidance/) or contact WA SOC on cybersecurity@dpc.wa.gov.au\\n<br><br>\\nversion control: v1.0 June 2024  \\n\\n---\\n## Instructions:\\n1. Select Workspace (Default to all)\\n2. Define Time Range of search. \\n3. Contact cybersecurity@dpc.wa.gov.au for further enquiries on this workbook\"},\"conditionalVisibility\":{\"parameterName\":\"Instructions\",\"comparison\":\"isEqualTo\",\"value\":\"Show\"},\"name\":\"text - 5\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"4e98761a-708b-4bda-98d7-a28a92c5a4f3\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Data Visibility\",\"subTarget\":\"data\",\"style\":\"link\"},{\"id\":\"2d942b71-f8b8-4340-8ade-2107a239a5b3\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Noisy Alerts\",\"subTarget\":\"rules\",\"style\":\"link\"},{\"id\":\"bac98777-467d-4c4f-a882-927620846f6a\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Log Ingestion\",\"subTarget\":\"cost\",\"style\":\"link\"}]},\"name\":\"links - 9\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Sentinel Logging Visibility\\n---\\n## The table below shows logging visibility into Sentinel\\n\",\"style\":\"info\"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\nlet ['mapping'] = datatable(['Data Connector']:string, Description:string, TableL:string, ['NIST CSF v2.0 Controls']:string)\\n[\\n'Azure Activity' , '1. Auditing and Health monitoring' , 'AzureActivity' , 'DE.CM-03; DE.CM-06; DE.CM-09' ,\\n'Azure Monitor' , '1. Auditing and Health monitoring' , 'Heartbeat' , 'DE.CM-03; DE.CM-06' ,\\n'Azure Monitor' , '1. Auditing and Health monitoring' , 'Perf' , 'DE.CM-03; DE.CM-06' ,\\n'Azure Monitor' , '1. Auditing and Health monitoring' , 'SentinelHealth' , 'DE.CM-03; DE.CM-06' ,\\n'Microsoft Entra ID' , '2. Identity & Credential Management' , 'AADManagedIdentitySignInLogs' , 'DE.CM-03; DE.CM-06; DE.CM-11' ,\\n'Microsoft Entra ID' , '2. Identity & Credential Management' , 'AADServicePrincipalSignInLogs' , 'DE.CM-03; DE.CM-06; DE.CM-12' ,\\n'Microsoft Entra ID' , '2. Identity & Credential Management' , 'AuditLogs' , 'DE.CM-03; DE.CM-06; DE.CM-10' ,\\n'Microsoft 365' , '2. Identity & Credential Management' , 'OfficeActivity' , 'DE.CM-09' ,\\n'Microsoft Defender for Identity' , '2. Identity & Credential Management' , 'SecurityAlert(AATP)' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Entra ID' , '2. Identity & Credential Management' , 'SigninLogs' , 'DE.CM-03; DE.CM-06; DE.CM-09' ,\\n'User Behavior Monitoring\\tUEBA' , '3. User and Entity Behavior Analytics (UEBA)' , 'BehaviorAnalytics' , 'DE.CM-03; DE.CM-06' ,\\n'User Behavior Monitoring\\tUEBA' , '3. User and Entity Behavior Analytics (UEBA)' , 'IdentityInfo' , 'DE.CM-03; DE.CM-06' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceFileEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceLogonEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceNetworkInfo' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceProcessEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '4. Operating Systems and Endpoints' , 'DeviceRegistryEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Azure Monitor' , '4. Operating Systems and Endpoints' , 'InsightsMetrics' , 'DE.CM-03; DE.CM-06' ,\\n'Microsoft Defender for Endpoint' , '4. Operating Systems and Endpoints' , 'SecurityAlert(MDATP)' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender XDR' , '4. Operating Systems and Endpoints' , 'SecurityAlert(XDR)' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Windows Security Events' , '4. Operating Systems and Endpoints' , 'SecurityEvent' , 'DE.CM-06; DE.CM-09' ,\\n'Syslog' , '4. Operating Systems and Endpoints' , 'Syslog(LinuxOS)' , 'DE.AE-03; DE.AE-06' ,\\n'Syslog' , '4. Operating Systems and Endpoints' , 'Syslog(MacOS)' , 'DE.AE-03; DE.AE-06' ,\\n'VMware ESXi' , '4. Operating Systems and Endpoints' , 'VMwareESXi' , 'DE.CM-03; DE.CM-06' ,\\n'Microsoft Defender' , '6. Azure Cloud Enviroment' , 'EmailAttachmentInfo' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '6. Azure Cloud Enviroment' , 'EmailEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender' , '6. Azure Cloud Enviroment' , 'EmailUrlInfo' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Purview Insider Risk Management' , '6. Azure Cloud Enviroment' , 'InformationProtectionLogs_CL' , 'ID.RA-02; DE.AE-03 ' ,\\n'Azure Kubernetes Service (AKS)' , '6. Azure Cloud Enviroment' , 'KubeEvents_CL' , 'ID.AM-02; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender for Cloud ' , '6. Azure Cloud Enviroment' , 'SecurityAlert(ASC)' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Defender for Cloud Apps' , '6. Azure Cloud Enviroment' , 'SecurityAlert(MCAS)' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Defender for Office 365' , '6. Azure Cloud Enviroment' , 'SecurityAlert(OATP)' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft 365 Insider Risk Management' , '6. Azure Cloud Enviroment' , 'SecurityAlert(OfficeIRM)' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Entra ID Protection' , '6. Azure Cloud Enviroment' , 'SecurityAlerts(IPC)' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Defender for Cloud' , '6. Azure Cloud Enviroment' , 'SecurityRecommendation' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Defender for Cloud' , '6. Azure Cloud Enviroment' , 'SecurityRegulatoryCompliance' , 'ID.AM-02; DE.AE-03; DE.CM-06 ' ,\\n'Microsoft Sentinel' , '6. Azure Cloud Enviroment' , 'ThreatIntelligenceIndicator' , 'ID.RA-02; DE.AE-03 ' ,\\n'Azure Automation' , '6. Azure Cloud Enviroment' , 'Update' , 'ID.IM-01; ID.AM-08' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureFirewalls)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureIDS)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureKeyVault)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureKubernetes)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureSQL)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(AzureWAF)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Azure Diagnostics' , '5. Network Device Infrastructure' , 'AzureDiagnostics(GatewayDiagnosticLog)' , 'DE.CM-01; DE.AE-02; DE.CM-09' ,\\n'Common Event Format (CEF)' , '5. Network Device Infrastructure' , 'CommonSecurityLog' , 'DE.CM-01' ,\\n'Microsoft Defender' , '5. Network Device Infrastructure' , 'DeviceNetworkEvents' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Windows DNS' , '5. Network Device Infrastructure' , 'DnsEvents' , 'DE.CM-01' ,\\n'Microsoft Endpoint Manager(Intune)' , '5. Network Device Infrastructure' , 'IntuneAuditLogs' , 'ID.AM-01; DE.AE-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Microsoft Defender for IoT' , '5. Network Device Infrastructure' , 'SecurityAlert(ASCforIoT)' , 'DE.AE-02, ID.RA-02, DE.AE-03; DE.CM-06; DE.CM-09' ,\\n'Amazon Web Services' , '7. AWS Cloud Enviroment' , 'AWSCloudTrail' , 'DE.CM-03; DE.CM-06'\\n];\\nunion isfuzzy=true\\n(AzureActivity | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Activity', TableR ='AzureActivity', Results),\\n(Heartbeat | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Monitor', TableR ='Heartbeat', Results),\\n(Perf | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Monitor', TableR ='Perf', Results),\\n(SentinelHealth | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Monitor', TableR ='SentinelHealth', Results),\\n(AADManagedIdentitySignInLogs | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Entra ID', TableR ='AADManagedIdentitySignInLogs', Results),\\n(AADServicePrincipalSignInLogs | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Entra ID', TableR ='AADServicePrincipalSignInLogs', Results),\\n(AuditLogs | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Entra ID', TableR ='AuditLogs', Results),\\n(OfficeActivity | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft 365', TableR ='OfficeActivity', Results),\\n(SecurityAlert | where ProductName == \\\"Azure Advanced Threat Protection\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Identity', TableR ='SecurityAlert(AATP)', Results),\\n(SigninLogs | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Entra ID', TableR ='SigninLogs', Results), \\n(BehaviorAnalytics | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'User Behavior Monitoring\\tUEBA', TableR ='BehaviorAnalytics', Results),\\n(IdentityInfo | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'User Behavior Monitoring\\tUEBA', TableR ='IdentityInfo', Results),\\n(DeviceEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceEvents', Results),\\n(DeviceFileEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceFileEvents', Results),\\n(DeviceLogonEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceLogonEvents', Results),\\n(DeviceNetworkInfo | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceNetworkInfo', Results),\\n(DeviceProcessEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceProcessEvents', Results),\\n(DeviceRegistryEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceRegistryEvents', Results),\\n(InsightsMetrics | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Monitor', TableR ='InsightsMetrics', Results),\\n(SecurityAlert | where ProviderName ==\\\"MDATP\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Endpoint', TableR ='SecurityAlert(MDATP)', Results),\\n(SecurityAlert | where ProductName in (\\\"Microsoft Defender Advanced Threat Protection\\\",\\\"Office 365 Advanced Threat Protection\\\",\\\"Azure Advanced Threat Protection\\\",\\\"Microsoft Cloud App Security\\\",\\\"Microsoft 365 Defender\\\")  | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender XDR', TableR ='SecurityAlert(XDR)', Results),\\n(SecurityEvent | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Windows Security Events', TableR ='SecurityEvent', Results),\\n(Syslog| where SourceSystem contains 'Linux' | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Syslog', TableR ='Syslog(LinuxOS)', Results),\\n(Syslog| where SourceSystem contains 'mac' or SourceSystem contains 'osx' | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Syslog', TableR ='Syslog(MacOS)', Results),\\n(VMwareESXi | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'VMware ESXi', TableR ='VMwareESXi', Results),\\n(EmailAttachmentInfo | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='EmailAttachmentInfo', Results),\\n(EmailEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='EmailEvents', Results),\\n(EmailUrlInfo | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='EmailUrlInfo', Results),\\n(InformationProtectionLogs_CL | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Purview Insider Risk Management', TableR ='InformationProtectionLogs_CL', Results),\\n(KubeEvents_CL | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Kubernetes Service (AKS)', TableR ='KubeEvents_CL', Results),\\n(SecurityAlert | where ProductName == \\\"Azure Security Center\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Cloud ', TableR ='SecurityAlert(ASC)', Results),\\n(SecurityAlert | where ProductName == \\\"Microsoft Cloud App Security\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Cloud Apps', TableR ='SecurityAlert(MCAS)', Results),\\n(SecurityAlert | where ProviderName == \\\"OATP\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Office 365', TableR ='SecurityAlert(OATP)', Results),\\n(SecurityAlert | where ProductName == \\\"Microsoft 365 Insider Risk Management\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft 365 Insider Risk Management', TableR ='SecurityAlert(OfficeIRM)', Results),\\n(SecurityAlert| where ProductName == \\\"Azure Active Directory Identity Protection\\\"  | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Entra ID Protection', TableR ='SecurityAlerts(IPC)', Results),\\n(SecurityRecommendation | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Cloud', TableR ='SecurityRecommendation', Results),\\n(SecurityRegulatoryCompliance | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for Cloud', TableR ='SecurityRegulatoryCompliance', Results),\\n(ThreatIntelligenceIndicator | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Sentinel', TableR ='ThreatIntelligenceIndicator', Results),\\n(Update | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Automation', TableR ='Update', Results),\\n(AzureDiagnostics | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics', Results),\\n(AzureDiagnostics| where ResourceType == \\\"AZUREFIREWALLS\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureFirewalls)', Results),\\n(AzureDiagnostics | where Category == \\\"AzureFirewallNetworkRule\\\" | where OperationName == \\\"AzureFirewallIDSLog\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureIDS)', Results),\\n(AzureDiagnostics | where ResourceProvider == \\\"MICROSOFT.KEYVAULT\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureKeyVault)', Results),\\n(AzureDiagnostics| where Category == \\\"kube-audit\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureKubernetes)', Results),\\n(AzureDiagnostics | where Category contains \\\"SQL\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureSQL)', Results),\\n(AzureDiagnostics | where ResourceType in (\\\"APPLICATIONGATEWAYS\\\", \\\"FRONTDOORS\\\", \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\", \\\"PROFILES\\\") | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(AzureWAF)', Results),\\n(AzureDiagnostics| where Category == 'GatewayDiagnosticLog' | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Azure Diagnostics', TableR ='AzureDiagnostics(GatewayDiagnosticLog)', Results),\\n(CommonSecurityLog | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Common Event Format (CEF)', TableR ='CommonSecurityLog', Results),\\n(DeviceNetworkEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender', TableR ='DeviceNetworkEvents', Results),\\n(DnsEvents | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Windows DNS', TableR ='DnsEvents', Results),\\n(IntuneAuditLogs | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Endpoint Manager(Intune)', TableR ='IntuneAuditLogs', Results),\\n(SecurityAlert | where ProductName == \\\"Azure Security Center for IoT\\\" | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Microsoft Defender for IoT', TableR ='SecurityAlert(ASCforIoT)', Results),\\n(AWSCloudTrail | limit 1 | summarize count() | extend Results = iff(count_ ==0, 0, 1) | project ['Connector'] = 'Amazon Web Services', TableR ='AWSCloudTrail', Results)\\n| join kind=rightouter (mapping) on $left.['TableR'] == $right.['TableL']\\n| project Table=TableL, ['Data Connector'], Description, Synced= iff(Results==0 or isempty(Results), 0, 1), SyncedIcon= iff(Results==0 or isempty(Results),\\\"❌\\\", \\\"✅\\\")\\n| extend joined_=strcat(Table, \\\" \\\", SyncedIcon)\\n| summarize ['Coverage(%)']= countif(Synced ==1)*1.00/count(), new =make_set(joined_) by Description\\n| extend ['Recommended Sentinel Tables'] = tostring(strcat_array(new,\\\", \\\"))\\n| project Description, ['Coverage(%)'], ['Recommended Sentinel Tables'] | order by Description asc \",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Description\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"Coverage(%)\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redGreen\",\"customColumnWidthSetting\":\"25ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\"}}},{\"columnMatch\":\"Recommended Sentinel Tables\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"350ch\"}}],\"sortBy\":[{\"itemKey\":\"Description\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Description\",\"sortOrder\":1}]},\"name\":\"query - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 1. Auditing and health monitoring\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\\n *Tables:* [Heartbeat](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/heartbeat) , [SentinelHealth](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/sentinelhealth) , [Perf](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/perf)\\n\\n- *DataConnector* [Azure Activity](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-activity) <br>\\n*Tables:*\\n[AzureActivity](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/azureactivity)\\n\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## Recommended actions\\n\\n- Turn on [auditing and health monitoring](https://learn.microsoft.com/en-us/azure/sentinel/enable-monitoring) <br> <br>\\n- Use [the health monitoring workbook](https://learn.microsoft.com/en-us/azure/sentinel/monitor-data-connector-health#use-the-health-monitoring-workbook) to monitor the health of your data connectors <br> <br>\\n- [Connect the Azure Activity](https://learn.microsoft.com/en-us/azure/sentinel/audit-sentinel-data) data source to audit Sentinel activities <br><br>\"},\"customWidth\":\"50\",\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Last Asset Log Received \\r\\nlet LastHeartbeatTime = Heartbeat| summarize LastHeartbeat_Time = arg_max(TimeGenerated, *) by ResourceId = tolower(ResourceId);\\r\\nHeartbeat| where TimeGenerated > ago(365d)| summarize LastHeartbeat = datetime_diff(\\\"second\\\",now(), max(TimeGenerated)) by ResourceId = tolower(ResourceId)\\r\\n| where ResourceId <> \\\"\\\"| where ResourceId <> \\\"None\\\"\\r\\n| join kind=inner (LastHeartbeatTime) on ResourceId| project ResourceId, LastHeartbeat, LastHeartbeat_Time| sort by LastHeartbeat desc\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"Last Asset Log Received - Heartbeat\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//SentinelHealth by SentinelResourceType\\r\\nSentinelHealth\\r\\n| distinct SentinelResourceType\",\"size\":1,\"showAnalytics\":true,\"title\":\"Monitor the health of your data connectors - SentinelHealth\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"query - 1 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Most activity by ResourceProvider\\r\\nAzureActivity \\r\\n| summarize count() by ResourceProvider, OperationNameValue\",\"size\":1,\"showAnalytics\":true,\"title\":\"Activity by Resource Provider - AzureActivity\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"3\"}]},\"name\":\"group - 2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Identity & Credential Management\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Microsoft Entra ID](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-active-directory) <br>\\n *Tables:* [AADManagedIdentitySignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadmanagedidentitysigninlogs) , [AADServicePrincipalSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadserviceprincipalsigninlogs) , [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) , [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs)\\n\\n- *DataConnector* [Microsoft 365](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365) <br>\\n*Tables:* [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity)\\n\\n- *DataConnector* [Microsoft Defender for Identity](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-defender-for-identity)\\n\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## Recommended actions\\n\\n- Find more details about [Microsoft Entra ID](https://www.microsoft.com/en-au/security/business/identity-access/microsoft-entra-id) <br> <br>\\n- Sync the [OfficeActivity](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365) table (SharePoint, Exchange, Teams activity logs) into Sentinel <br> <br>\\n- Deploy [Microsoft Defender for Identity](https://learn.microsoft.com/en-us/defender-for-identity/deploy/quick-installation-guide) <br><br>\"},\"customWidth\":\"50\",\"name\":\"text - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//User/Group/Entitlement Management\\r\\nAuditLogs\\r\\n| where Category == \\\"UserManagement\\\" or Category == \\\"EntitlementManagement\\\" or Category == \\\"GroupManagement\\\"\\r\\n| summarize count() by OperationName\",\"size\":1,\"showAnalytics\":true,\"title\":\"User/Group/Entitlement Management (Microsoft Entra ID) - Audit Logs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"View User/Group/Entitlement Management (Microsoft Entra ID) - Audit Logs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Management Actions, Privilege Elevation (Privileged Identity Management)\\r\\nAuditLogs\\r\\n| where Identity == \\\"MS-PIM\\\"\\r\\n| summarize count() by OperationName\",\"size\":1,\"showAnalytics\":true,\"title\":\"Management Actions, Privilege Elevation (Privileged Identity Management) - AuditLogs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Management Actions, Privilege Elevation (Privileged Identity Management)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// User/Group Changes\\r\\nAuditLogs\\r\\n| where OperationName contains \\\"role\\\" or OperationName contains \\\"user\\\" or OperationName contains \\\"principal\\\" or OperationName contains \\\"member\\\" or OperationName contains \\\"group\\\"\\r\\n| where OperationName !contains \\\"invite\\\"\\r\\n| where OperationName !contains \\\"external\\\"\\r\\n| where OperationName !contains \\\"licnense\\\"\\r\\n| summarize count() by OperationName , Identity, tostring(TargetResources[0].userPrincipalName)\",\"size\":1,\"showAnalytics\":true,\"title\":\"User/Group Changes - AuditLogs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"User/Group Changes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Content Filtering Policy Updates (Microsoft 365)\\r\\nOfficeActivity\\r\\n| where Operation contains \\\"policy\\\"\\r\\n| where Operation !contains \\\"access\\\"\\r\\n| summarize count() by RecordType, Operation\",\"size\":1,\"showAnalytics\":true,\"title\":\"Content Filtering Policy Updates (Microsoft 365) - OfficeActivity\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Content Filtering Policy Updates (Microsoft 365)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" // Exchange Logs (Microsoft 365)\\r\\nOfficeActivity\\r\\n| where OfficeWorkload == \\\"Exchange\\\"\\r\\n| project Operation, MailboxOwnerUPN, ClientIP\",\"size\":1,\"showAnalytics\":true,\"title\":\"Exchange Logs (Microsoft 365) - OfficeActivity\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Exchange Logs (Microsoft 365)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Exchange Policy Changes (Microsoft 365)\\r\\nOfficeActivity\\r\\n| where RecordType == \\\"ExchangeAdmin\\\"\\r\\n| where Operation contains \\\"policy\\\"\\r\\n| where Operation !contains \\\"access\\\"\\r\\n| summarize count() by Operation\",\"size\":1,\"showAnalytics\":true,\"title\":\"Exchange Policy Changes (Microsoft 365) - OfficeActivity\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Exchange Policy Changes (Microsoft 365) - OfficeActivity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert \\r\\n| where ProductName == \\\"Azure Advanced Threat Protection\\\"\\r\\n| summarize count() by AlertName\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure Advanced Threat Protection - SecurityAlert (AATP)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Azure Advanced Threat Protection\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Accessing Management CLI/Powershell Functions (Microsoft Entra ID)\\r\\nlet applications = dynamic([\\\"Azure Active Directory PowerShell\\\", \\\"Microsoft Azure PowerShell\\\", \\\"Graph Explorer\\\", \\\"ACOM Azure Website\\\"]);\\r\\nSigninLogs \\r\\n| where AppDisplayName in (applications)\\r\\n| summarize count() by AppDisplayName, Identity\",\"size\":1,\"showAnalytics\":true,\"title\":\"Accessing Management CLI/Powershell Functions (Microsoft Entra ID) - SigninLogs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Accessing Management CLI/Powershell Functions (Microsoft Entra ID)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Admin Authentication (needs IdentityInfo)\\r\\nIdentityInfo\\r\\n| where AssignedRoles contains \\\"Admin\\\" or AssignedRoles contains \\\"owner\\\" or AssignedRoles contains \\\"contributor\\\"\\r\\n| join (SigninLogs) on $left.AccountUPN == $right.UserPrincipalName\\r\\n| summarize count() by AccountUPN, AppDisplayName\",\"size\":1,\"showAnalytics\":true,\"title\":\"Admin Authentication - IdentityInfo/SigninLogs\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Admin Authentication - IdentityInfo/SigninLogs\"}]},\"name\":\"group - 2 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 3. User and Entity Behavior Analytics (UEBA)\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Entity Behavior (UEBA)](https://docs.microsoft.com/azure/sentinel/enable-entity-behavior-analytics) <br>\\n *Tables:* [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) , [IdentityInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/identityinfo)\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## Recommended actions\\n\\n- Enable [User and Entity Behavior Analytics (UEBA)](https://learn.microsoft.com/en-us/azure/sentinel/enable-entity-behavior-analytics?tabs=azure) in Microsoft Sentinel <br> <br>\"},\"customWidth\":\"50\",\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// User Entity Behavior Analytics\\r\\nBehaviorAnalytics\\r\\n| where ActionType == \\\"Sign-in\\\"\\r\\n| where (UsersInsights.NewAccount == True or UsersInsights.DormantAccount == True) and (ActivityInsights.FirstTimeUserAccessedResource == True and ActivityInsights.ResourceUncommonlyAccessedAmongPeers == True or ActivityInsights.FirstTimeUserUsedApp == True and ActivityInsights.AppUncommonlyUsedAmongPeers == False)\\r\\n| join (SigninLogs | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \\\"none\\\") on $left.SourceRecordId == $right._ItemId\\r\\n| extend UserPrincipalName = iff(UserPrincipalName contains \\\"#EXT#\\\", replace(\\\"_\\\", \\\"@\\\", tostring(split(UserPrincipalName, \\\"#\\\")[0])), UserPrincipalName), UserName = iff(UserName contains \\\"#EXT#\\\", replace(\\\"_\\\", \\\"@\\\", tostring(split(UserPrincipalName, \\\"#\\\")[0])), UserName)\\r\\n| extend AnomalyName = \\\"Anomalous Successful Logon\\\"\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"User Entity Behavior Analytics - BehaviorAnalytics\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"User Entity Behavior Analytics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Privileged Roles/Groups (Microsoft Sentinel)\\r\\nIdentityInfo \\r\\n| where GroupMembership contains \\\"admin\\\" or GroupMembership contains \\\"contributor\\\" or AssignedRoles contains \\\"admin\\\" or AssignedRoles contains \\\"contributor\\\"\\r\\n| summarize count() by AccountUPN, tostring(GroupMembership)\",\"size\":1,\"showAnalytics\":true,\"title\":\"Privileged Roles/Groups (Microsoft Sentinel) - IdentityInfo\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Privileged Roles/Groups (Microsoft Sentinel)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Admin Sign Ins (Microsoft Entra ID)\\r\\nIdentityInfo\\r\\n| where AssignedRoles contains \\\"Admin\\\" or AssignedRoles contains \\\"owner\\\" or AssignedRoles contains \\\"contributor\\\"\\r\\n| join (SigninLogs) on $left.AccountUPN == $right.UserPrincipalName\\r\\n| extend Country = tostring(LocationDetails.countryOrRegion)\\r\\n| where ResultType == 0\\r\\n| project UserPrincipalName, AssignedRoles, Department, JobTitle, Country, TimeGenerated\\r\\n| sort by TimeGenerated desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Admin Sign Ins (Microsoft Entra ID) - IdentityInfo\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Admin Sign Ins (Microsoft Entra ID)\"}]},\"name\":\"group - 2 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 4. Operating Systems and Endpoints\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Microsoft Defender XDR](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365-defender) <br>\\n *Tables:* [DeviceEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/deviceevents), [DeviceFileEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/devicefileevents) , [DeviceLogonEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/devicelogonevents) , [DeviceNetworkInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/devicenetworkinfo) , [DeviceProcessEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/deviceprocessevents) , [DeviceRegistryEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/deviceregistryevents)\\n \\n \\n- *DataConnector* [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\\n *Tables:* [InsightsMetrics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/insightsmetrics)\\n \\n- *DataConnector* [Windows Security Events via AMA](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/windows-security-events-via-ama) <br>\\n *Tables:* [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent)  \\n \\n- *DataConnector* [Syslog](https://docs.microsoft.com/azure/sentinel/connect-syslog) <br>\\n *Tables:*  [Syslog](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/syslog)\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## Recommended actions\\n\\n- Deploy [Microsoft Defender for Endpoint](https://learn.microsoft.com/en-us/defender-endpoint/mde-planning-guide?view=o365-worldwide) or now part of [Microsoft Defender XDR](https://learn.microsoft.com/en-us/defender-xdr/) <br> <br>\\n- Use [Attack Surface Reduction (ASR)](https://learn.microsoft.com/en-us/defender-endpoint/overview-attack-surface-reduction?view=o365-worldwide) <br> <br>\\n- Connect [Syslog logs](https://learn.microsoft.com/en-us/azure/sentinel/cef-syslog-ama-overview?tabs=single) to Sentinel  <br> <br>\\n- Assess important activities loged in [Security Events](https://soc.cyber.wa.gov.au/baselines/data-sources/#66-important-activities) <br> <br>\\n\"},\"customWidth\":\"50\",\"name\":\"text - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Network connections and related events initiated by processes running on the endpoint.\\r\\n//DeviceNetworkInfo > DHCP: Lease, IP, MAC (Microsoft Sentinel) > \\r\\nDeviceNetworkInfo  \\r\\n| summarize FirstObserved=arg_min(TimeGenerated, IPv4Dhcp, IPAddresses, MacAddress, MachineGroup, DnsAddresses) by DeviceName\",\"size\":1,\"showAnalytics\":true,\"title\":\"DeviceNetworkInfo > DHCP: Lease, IP, MAC (Microsoft Sentinel)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"User Entity Behavior Analytics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert \\n| where ProviderName ==\\\"MDATP\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Defender for Endpoint\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Defender for Endpoint\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert \\r\\n| where ProductName in (\\\"Microsoft Defender Advanced Threat Protection\\\",\\\"Office 365 Advanced Threat Protection\\\",\\\"Azure Advanced Threat Protection\\\",\\\"Microsoft Cloud App Security\\\",\\\"Microsoft 365 Defender\\\")\\r\\n| summarize count() by AlertName, ProductName\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Defender XDR\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Defender XDR\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Linux OS\\r\\nSyslog\\r\\n| where SourceSystem == \\\"Linux\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Linux OS\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Linux OS\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Sudo Activity (Syslog) > \\r\\nSyslog\\r\\n| where SyslogMessage <> \\\"\\\"\\r\\n| where SyslogMessage contains \\\"sudo\\\" or SyslogMessage contains \\\"runas\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Sudo Activity (Syslog)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Sudo Activity (Syslog)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Mac OS Syslog \\r\\nSyslog\\r\\n| where SourceSystem contains \\\"mac\\\" or SourceSystem contains \\\"osx\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Mac OS Syslog \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Mac OS Syslog \"}]},\"name\":\"4. Operating Systems and Endpoints\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 5. Network Device Infrastructure\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"- *DataConnector* [Azure Firewall](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-firewall) , [Azure SQL Databases Connector](https://docs.microsoft.com/azure/sentinel/data-connectors-reference#azure-sql-databases) , [Azure Web Application Firewall](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-web-application-firewall-waf) , [Network Security Groups](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/network-security-groups) , [Azure Key Vault](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-key-vault) , [Azure Kubernetes Service (AKS) Connector](https://docs.microsoft.com/azure/sentinel/data-connectors-reference#azure-kubernetes-service-aks) , [Azure DDoS Connector](https://docs.microsoft.com/azure/sentinel/data-connectors-reference#azure-ddos-protection) , [VPN Gateway Alerts](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-setup-alerts-virtual-network-gateway-log) , [TunnelDiagnosticLog](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-setup-alerts-virtual-network-gateway-log) <br>\\n *Tables:* [AzureDiagnostics](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/azurediagnostics)\\n\\n- *DataConnector* [Common Event Format (CEF)](https://docs.microsoft.com/azure/sentinel/connect-common-event-format) <br>\\n *Tables:* [CommonSecurityLog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/commonsecuritylog)\\n\\n- *DataConnector* [Microsoft Defender XDR](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365-defender) <br>\\n *Tables:* [DeviceNetworkEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/devicenetworkevents)\\n\\n- *DataConnector* [DNS](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/dns) <br>\\n *Tables:* [DnsEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/dnsevents)\\n\\n- *DataConnector* [Microsoft Endpoint Manager](https://www.microsoft.com/security/business/microsoft-endpoint-manager) <br>\\n *Tables:* [IntuneAuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/intuneauditlogs)\\n\\n- *DataConnector* [Microsoft Defender for IoT](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-defender-for-iot)\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"## Recommended actions\\n\\n- Deploy [third party solutions](https://soc.cyber.wa.gov.au/onboarding/sentinel-guidance/#3-third-party-solutions-telemetry-re-ingestion) <br> <br>\\n\"},\"customWidth\":\"50\",\"name\":\"text - 19\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Network Security Groups (NSG) \\r\\nAzureDiagnostics\\r\\n| where Category == \\\"NetworkSecurityGroupEvent\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Network Security Groups (NSG) \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Network Security Groups (NSG) \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Azure Firewall \\nAzureDiagnostics\\n| where ResourceType == \\\"AZUREFIREWALLS\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure Firewall \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Azure Firewall\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//AzureWAF\\r\\nAzureDiagnostics | where ResourceType in (\\\"APPLICATIONGATEWAYS\\\", \\\"FRONTDOORS\\\", \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\", \\\"PROFILES\\\")\",\"size\":1,\"showAnalytics\":true,\"title\":\"AzureWAF\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"AzureWAF\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//AzureIDS \\r\\nAzureDiagnostics | where Category == \\\"AzureFirewallNetworkRule\\\" | where OperationName == \\\"AzureFirewallIDSLog\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"AzureIDS \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"AzureIDS \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//AzureKeyVault\\r\\nAzureDiagnostics | where ResourceProvider == \\\"MICROSOFT.KEYVAULT\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"AzureKeyVault\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"AzureKeyVault\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Azure Kubernetes Service (AKS) \\r\\nAzureDiagnostics\\r\\n| where Category == \\\"kube-audit\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure Kubernetes Service (AKS)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Azure Kubernetes Service (AKS)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Container Activity Logs (Azure Monitor)\\r\\nAzureDiagnostics\\r\\n| where ResourceProvider == \\\"MICROSOFT.CONTAINERSERVICE\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Container Activity Logs (Azure Monitor)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Container Activity Logs (Azure Monitor)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// VPN Gateway Configuration Logs (VPN Gateway)\\r\\nAzureDiagnostics\\r\\n|where Category == 'GatewayDiagnosticLog'\",\"size\":1,\"showAnalytics\":true,\"title\":\"VPN Gateway Configuration Logs (VPN Gateway)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"VPN Gateway Configuration Logs (VPN Gateway)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Tunnel State Change & Connections Logs (VPN Gateway) \\r\\nAzureDiagnostics\\r\\n|where Category == 'TunnelDiagnosticLog'\",\"size\":1,\"showAnalytics\":true,\"title\":\"Tunnel State Change & Connections Logs (VPN Gateway)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Tunnel State Change & Connections Logs (VPN Gateway)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// IKE Control Messages & Events (VPN Gateway) \\r\\nAzureDiagnostics\\r\\n|where Category == 'IKEDiagnosticLog'\",\"size\":1,\"showAnalytics\":true,\"title\":\"IKE Control Messages & Events (VPN Gateway)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"IKE Control Messages & Events (VPN Gateway)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// SQL \\r\\nAzureDiagnostics \\r\\n| where Category contains \\\"SQL\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"SQL \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"SQL \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Azure DDoS \\r\\nAzureDiagnostics \\r\\n| where ResourceType == \\\"PUBLICIPADDRESSES\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure DDoS \",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Azure DDoS \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Changes to Static Routes and BGP Events (VPN Gateway) \\r\\nAzureDiagnostics\\r\\n|where Category == 'RouteDiagnosticLog'\",\"size\":1,\"showAnalytics\":true,\"title\":\"Changes to Static Routes and BGP Events (VPN Gateway)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Changes to Static Routes and BGP Events (VPN Gateway)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Web Application Firewall (Azure WAF) \\r\\nAzureDiagnostics  \\r\\n| where (ResourceType == \\\"APPLICATIONGATEWAYS\\\" or ResourceType == \\\"FRONTDOORS\\\" or ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\") and (\\\"Application Gateway\\\" == \\\"All\\\" or (ResourceType == \\\"APPLICATIONGATEWAYS\\\" and \\\"Application Gateway\\\" contains \\\"application gateway\\\") or (ResourceType == \\\"FRONTDOORS\\\" and \\\"Application Gateway\\\" contains \\\"azure front door\\\") or (ResourceType == \\\"CDNWEBAPPLICATIONFIREWALLPOLICIES\\\" and \\\"Application Gateway\\\" contains \\\"cdn\\\"))\\r\\n| where Category == \\\"FrontdoorWebApplicationFirewallLog\\\" or OperationName == \\\"ApplicationGatewayFirewall\\\" or Category == \\\"WebApplicationFirewallLogs\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Web Application Firewall (Azure WAF)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Web Application Firewall (Azure WAF)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// IDS / IPS Alerts over Time (Azure Firewall)\\r\\nAzureDiagnostics\\r\\n| where Category == \\\"AzureFirewallNetworkRule\\\"\\r\\n| where OperationName == \\\"AzureFirewallIDSLog\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\" IDS / IPS Alerts over Time (Azure Firewall)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\" IDS / IPS Alerts over Time (Azure Firewall)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Security Appliances\\r\\nCommonSecurityLog\\r\\n| summarize count() by DeviceProduct, DeviceVendor, TenantId, DeviceVersion, DeviceEventClassID\",\"size\":1,\"showAnalytics\":true,\"title\":\" IDS / IPS Alerts over Time (Azure Firewall)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\" IDS / IPS Alerts over Time (Azure Firewall) - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert \\r\\n| where ProductName == \\\"Azure Security Center for IoT\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Defender for IoT\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Defender for IoT\"}]},\"name\":\"4. Operating Systems and Endpoints - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 6. Azure Cloud Enviroment\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Microsoft Defender XDR](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365-defender) <br>\\n *Tables:* [EmailAttachmentInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/emailattachmentinfo) , [EmailEvents](https://docs.microsoft.com/microsoft-365/security/defender/advanced-hunting-emailevents-table) , [EmailUrlInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/emailurlinfo)\\n \\n \\n- *DataConnector* [Azure Information Protection](https://docs.microsoft.com/azure/sentinel/data-connectors-reference#azure-information-protection-preview) <br>\\n *Tables:* [InformationProtectionLogs_CL](https://docs.microsoft.com/azure/information-protection/audit-logs)\\n \\n- *DataConnector* [Azure Kubernetes Service (AKS)](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/azure-kubernetes-service-aks) <br>\\n *Tables:* [KubeEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/kubeevents) \\n \\n- *DataConnector* [Microsoft Defender for Cloud](https://docs.microsoft.com/azure/sentinel/data-connectors-reference#microsoft-defender-for-cloud) <br>\\n *Tables:*  [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-cloud/continuous-export?tabs=azure-portal#what-data-types-can-be-exported) , [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance)\\n\\n- *DataConnector* [Threat Intelligence TAXII](https://docs.microsoft.com/azure/sentinel/connect-threat-intelligence-taxii) <br>\\n *Tables* [ThreatIntelligenceIndicator](https://docs.microsoft.com/azure/azure-monitor/reference/tables/threatintelligenceindicator)\\n\\n- REVIEW *DataConnector* [Automation](https://azure.microsoft.com/services/automation/) <br>\\n *Tables* [Update](https://docs.microsoft.com/azure/azure-monitor/reference/tables/update)\\n\\n- *DataConnector* [Microsoft Defender for Cloud Apps](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-defender-for-cloud-apps)\\n\\n- *DataConnector* [Microsoft Defender for Office 365](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-defender-for-office-365)\\n\\n- *DataConnector* [Microsoft 365 Insider Risk Management](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-365-insider-risk-management)\\n\\n- *DataConnector* [Microsoft Entra ID Protection](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/microsoft-entra-id-protection)\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Configured Email Filtering Policies (Microsoft 365)\\r\\nEmailEvents\\r\\n| summarize count() by ConfidenceLevel, DetectionMethods, DeliveryAction, EmailActionPolicy\",\"size\":1,\"showAnalytics\":true,\"title\":\"Configured Email Filtering Policies (Microsoft 365)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Configured Email Filtering Policies (Microsoft 365)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Configured Spam Filtering Policies (Microsoft 365)\\nEmailEvents\\n| where ConfidenceLevel contains \\\"spam\\\" or DetectionMethods contains \\\"spam\\\" or DeliveryAction == \\\"Junked\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Configured Spam Filtering Policies (Microsoft 365)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Configured Spam Filtering Policies (Microsoft 365)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert | where ProductName == \\\"Azure Security Center\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Defender for Cloud (Legacy)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Defender for Cloud (Legacy)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert | where ProductName == \\\"Microsoft Cloud App Security\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Cloud App Security\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Cloud App Security\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert | where ProviderName == \\\"OATP\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Defender for Office 365\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Defender for Office 365\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityAlert | where ProductName == \\\"Microsoft 365 Insider Risk Management\\\"\",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Purview: Insider Risk Management\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Purview: Insider Risk Management\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//SecurityAlert (Entra ID Protection) \\nSecurityAlert | where ProductName == \\\"Azure Active Directory Identity Protection\\\" \",\"size\":1,\"showAnalytics\":true,\"title\":\"Alerts from Microsoft Entra ID Protection\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Alerts from Microsoft Entra ID Protection\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Unhealthy assets\\nSecurityRecommendation\\n| where RecommendationState contains 'unhealthy'\",\"size\":1,\"showAnalytics\":true,\"title\":\"Security Recommendations - Unhealthy Assets\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Security Recommendations - Unhealthy assets\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Security Recommendations (Microsoft Defender for Cloud)\\nSecurityRecommendation \\n| summarize arg_max(TimeGenerated,*) by RecommendationName\\n| project RecommendationDisplayName, RecommendationLink\",\"size\":1,\"showAnalytics\":true,\"title\":\"Security Recommendations (Microsoft Defender for Cloud)\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Security Recommendations (Microsoft Defender for Cloud)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//ThreatIntelligence\\nThreatIntelligenceIndicator \\n| where SourceSystem in (\\\"SecurityGraph\\\", \\\"Azure Sentinel\\\", \\\"Microsoft Sentinel\\\")\",\"size\":1,\"showAnalytics\":true,\"title\":\"ThreatIntelligence\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"ThreatIntelligence\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Software updates > Azure Automation Update Management > \\nUpdate \\n| project _ResourceId, Classification, Title, PublishedDate, KBID, RevisionNumber, Optional, RebootBehavior, Approved, ApprovalSource, ProductVersion, PackageRepository, Type, ResourceGroup, ResourceType, OSType, ProductArch, CVENumbers, UpdateState, Product, SourceSystem\",\"size\":1,\"showAnalytics\":true,\"title\":\"Azure Automation Update Management\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"Azure Automation Update Management\"}]},\"name\":\"4. Operating Systems and Endpoints - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 7. AWS Cloud Enviroment\",\"style\":\"success\"},\"name\":\"text - 21\"},{\"type\":1,\"content\":{\"json\":\"## Recommended logs\\n\\n- *DataConnector* [Amazon Web Services S3](https://learn.microsoft.com/en-us/azure/sentinel/data-connectors/amazon-web-services-s3) <br>\\n *Tables:* [AWSCloudTrail](https://docs.microsoft.com/azure/azure-monitor/reference/tables/awscloudtrail)\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AWSCloudTrail\",\"size\":1,\"showAnalytics\":true,\"title\":\"AWSCloudTrail\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsConnected\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"green\",\"text\":\"Yes\"},{\"operator\":\"==\",\"thresholdValue\":\"false\",\"representation\":\"red\",\"text\":\"No\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"lightBlue\",\"text\":\"{0}{1}\"}]}}],\"rowLimit\":10000}},\"customWidth\":\"33\",\"name\":\"AWSCloudTrail\"}]},\"name\":\"7. AWS Cloud Enviroment\",\"styleSettings\":{\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"data\"},\"name\":\"data visibility\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Noisy\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Top Noisy Alerts \\n---\\n### The table below depicts the top 5 firing SecurityIncidents with Severity of \\\"Medium\\\" or \\\"High\\\" that have triggered more than 60 times in the past month and have not been closed as a TruePositive\",\"style\":\"info\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\n| where TimeGenerated > ago(30d)\\n| summarize arg_max(TimeGenerated, *) by IncidentName\\n| where Severity has_any (\\\"Medium\\\", \\\"High\\\")\\n| where Classification != 'TruePositive'\\n| summarize count() by Title, Severity, ProviderName, TenantId\\n    | where count_ > 60\\n    | project Title, Severity, ProviderName, Count = count_\\n    | top 5 by Count desc\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Title\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"120ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"ProviderName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"35ch\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}}]}},\"name\":\"query - 1\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"rules\"},\"name\":\"group - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Sentinel Log Ingestion Volume Summary\\n---\\n## The table below depicts volumes of log ingestion into Sentinel\",\"style\":\"info\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Categories = datatable(Type:string,Category:string)\\n[\\n\\\"AuditLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"SigninLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADNonInteractiveUserSignInLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADRiskyUsers\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADRiskyServicePrincipals\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADServicePrincipalRiskEvents\\\" , \\\"Azure Active Directory\\\",\\n\\\"ADFSSignInLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"NetworkAccessTraffic\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADUserRiskEvents\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADServicePrincipalSignInLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADManagedIdentitySignInLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"AADProvisioningLogs\\\" , \\\"Azure Active Directory\\\",\\n\\\"AZFWApplicationRule\\\" , \\\"Firewall\\\",\\n\\\"AZFWApplicationRuleAggregation\\\" , \\\"Firewall\\\",\\n\\\"AZFWDnsQuery\\\" , \\\"Firewall\\\",\\n\\\"AZFWIdpsSignature\\\" , \\\"Firewall\\\",\\n\\\"AZFWNatRule\\\" , \\\"Firewall\\\",\\n\\\"AZFWNatRuleAggregation\\\" , \\\"Firewall\\\",\\n\\\"AZFWNetworkRule\\\" , \\\"Firewall\\\",\\n\\\"AZFWNetworkRuleAggregation\\\" , \\\"Firewall\\\",\\n\\\"WindowsFirewall\\\" , \\\"Firewall\\\",\\n\\\"Event\\\" , \\\"Custom Events\\\",\\n\\\"BehaviorAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\n\\\"UserPeerAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\n\\\"UserAccessAnalytics\\\" , \\\"User Entity Behavior Analytics\\\",\\n\\\"IdentityInfo\\\" , \\\"User Entity Behavior Analytics\\\",\\n\\\"DeviceLogonEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceNetworkInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceImageLoadEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceFileEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceProcessEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceNetworkEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceRegistryEvents\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"DeviceFileCertificateInfo\\\" , \\\"Microsoft Defender for Endpoint\\\",\\n\\\"EmailAttachmentInfo\\\" , \\\"Microsoft Defender for Office 365\\\",\\n\\\"EmailEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\n\\\"EmailPostDeliveryEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\n\\\"EmailUrlInfo\\\" , \\\"Microsoft Defender for Office 365\\\",\\n\\\"IdentityLogonEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\n\\\"IdentityQueryEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\n\\\"IdentityDirectoryEvents\\\" , \\\"Microsoft Defender for Identity\\\",\\n\\\"CloudAppEvents\\\" , \\\"Microsoft Defender for Cloud Apps\\\",\\n\\\"AlertEvidence\\\" , \\\"Microsoft Defender Alert Evidence\\\",\\n\\\"InsightsMetrics\\\" , \\\"Azure Monitor for VMs\\\",\\n\\\"VMBoundPort\\\" , \\\"Azure Monitor for VMs\\\",\\n\\\"VMComputer\\\" , \\\"Azure Monitor for VMs\\\",\\n\\\"VMConnection\\\" , \\\"Azure Monitor for VMs\\\",\\n\\\"VMProcess\\\" , \\\"Azure Monitor for VMs\\\",\\n\\\"SecurityEvent\\\" , \\\"Windows Security Events\\\",\\n\\\"StorageBlobLogs\\\" , \\\"Azure Storage\\\",\\n\\\"StorageFileLogs\\\" , \\\"Azure Storage\\\",\\n\\\"Syslog\\\" , \\\"Syslog/CEF\\\",\\n\\\"SecurityIoTRawEvent\\\" , \\\"IoT Logs\\\",\\n\\\"CommonSecurityLog\\\" , \\\"Syslog/CEF\\\",\\n\\\"ThreatIntelligenceIndicator\\\" , \\\"Sentinel\\\",\\n\\\"DnsEvents\\\" , \\\"DNS Logs\\\",\\n\\\"DnsInventory\\\" , \\\"DNS Logs\\\",\\n\\\"AWSCloudTrail\\\" , \\\"AWS Logs\\\",\\n\\\"AWSVPCFlow\\\" , \\\"AWS Logs\\\",\\n\\\"ConfigurationChange\\\" , \\\"Change Tracking\\\",\\n\\\"ConfigurationData\\\" , \\\"Change Tracking\\\",\\n\\\"AzureDiagnostics\\\" , \\\"Azure Resources\\\",\\n\\\"AzureActivity\\\" , \\\"Azure Resources\\\",\\n\\\"LAQueryLogs\\\" , \\\"Management\\\",\\n\\\"SentinelHealth\\\" , \\\"Sentinel\\\",\\n\\\"Perf\\\" , \\\"Performance\\\",\\n\\\"AzureMetrics\\\" , \\\"Azure Metrics\\\",\\n\\\"SecurityNestedRecommendation\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"SecurityRecommendation\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"SecurityRegulatoryCompliance\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"SecureScoreControls\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"SecurityBaseline\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"SecureScores\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"Update\\\" , \\\"Update Management\\\",\\n\\\"UpdateSummary\\\" , \\\"Update Management\\\",\\n\\\"DeviceTvmSecureConfigurationAssessment\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\n\\\"DeviceTvmSoftwareVulnerabilities\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\n\\\"DeviceTvmSoftwareInventory\\\" , \\\"Microsoft Defender Vuln. Management\\\",\\n\\\"UrlClickEvents\\\" , \\\"Microsoft Defender for Office 365\\\",\\n\\\"SecurityBaselineSummary\\\" , \\\"Microsoft Defender for Cloud\\\",\\n\\\"AZFWThreatIntel\\\" , \\\"Firewall\\\",\\n\\\"AWSGuardDuty\\\" , \\\"AWS Logs\\\",\\n\\\"Watchlist\\\" , \\\"Sentinel\\\",\\n\\\"HuntingBookmark\\\" , \\\"Sentinel\\\",\\n\\\"SentinelAudit\\\" , \\\"Sentinel\\\",\\n\\\"Operation\\\" , \\\"Log Management\\\",\\n\\\"StorageTableLogs\\\" , \\\"Azure Storage\\\",\\n\\\"AddonAzureBackupStorage\\\" , \\\"Azure Storage\\\",\\n\\\"AddonAzureBackupPolicy\\\" , \\\"Azure Storage\\\",\\n\\\"StorageQueueLogs\\\" , \\\"Azure Storage\\\",\\n\\\"AddonAzureBackupProtectedInstance\\\" , \\\"Azure Storage\\\",\\n\\\"AddonAzureBackupJobs\\\" , \\\"Azure Storage\\\"\\n];\\nlet customTables = Usage\\n| where IsBillable == true\\n| where DataType contains \\\"_CL\\\"\\n| summarize size = sum(Quantity)/1024 by DataType\\n| project ['Log Type'] = \\\"Custom Log\\\",['Table'] = DataType, ['Table Size'] = size;\\nlet AzDiagTables = AzureDiagnostics\\n| summarize TotalIngestBytes=sum(_BilledSize) by Category\\n| project ['Log Type'] = \\\"AzureDiagnostics\\\", ['Table'] = Category ,['Table Size'] = TotalIngestBytes/1024000000;\\nlet knownTables = Usage\\n| where IsBillable == true \\n| where DataType <> \\\"AzureDiagnostics\\\"\\n| join kind=leftouter Categories on $left.DataType == $right.Type\\n| summarize size =sumif(Quantity, isnotempty(Category))/1024, sizeOther= sumif(Quantity,(isempty(Category) and DataType !contains \\\"_CL\\\"))/1024 by Category, DataType\\n| project ['Log Type'] = iif(isnotempty( Category),Category,\\\"Other\\\"), ['Table'] = DataType, ['Table Size'] = iif(isnotempty( Category),size ,sizeOther);\\nunion customTables, knownTables, AzDiagTables\\n| sort by ['Table Size'] desc\",\"size\":0,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"Log Type\",\"formatter\":5,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"Table\",\"formatter\":5},{\"columnMatch\":\"Table Size\",\"formatter\":4,\"formatOptions\":{\"palette\":\"green\",\"aggregation\":\"Sum\",\"customColumnWidthSetting\":\"100ch\"},\"numberFormat\":{\"unit\":39,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Log Type\"],\"finalBy\":\"Table\"}}},\"name\":\"query - 1\"}]},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"cost\"},\"name\":\"group 4\"}],\"isLocked\":false,\"fallbackResourceIds\":[],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
      "version": "1.0",
      "sourceId": "[variables('workbookSourceId')]",
      "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}
