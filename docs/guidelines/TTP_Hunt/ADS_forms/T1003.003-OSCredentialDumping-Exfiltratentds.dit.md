## T1003 - OS Credential Dumping: Exfiltrate ntds.dit

A technique by which the adversary may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password.

!!! example
    ```
    cmd /c copy \\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy3\\Windows\\NTDS\\ntds.dit C:\\Windows\\Temp > C:\\Windows\\Temp\<filename>.tmp
    ```

!!! tip "Related"
    Volt Typhoon activity

### Reference:

https://www.microsoft.com/en-us/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/%5C
https://www.cyber.gov.au/about-us/advisories/prc-state-sponsored-cyber-actor-living-off-the-land-to-evade-detection%5C
https://risksense.com/blog/hidden-gems-in-windows-the-hunt-is-on%5C
https://docs.microsoft.com/sysinternals/downloads/procdump

### ATT&CK TACTICS

{{ mitre("T1003.001")}}\
{{ mitre("T1003.003")}}

Data Source(s): [Process](https://attack.mitre.org/datasources/DS0009/), [Command](https://attack.mitre.org/datasources/DS0017/)

### SENTINEL RULE QUERY

```
let c1 = dynamic(["ntds.dit"]); 
find where InitiatingProcessCommandLine has_all (c1) or ProcessCommandLine has_all (c1) or CommandLine has_all (c1)
```

### Triage

1. Inspect which account and at what time the activity was performed
1. Question the user if the activity was expected and approved

### False Positive

1. Back up software
    > "ESENTUTL.EXE" .. "C:\\Program Files\\Veritas.." "\\?...\\NTDS\\ntds.dit"

### VERSION

Version 1.1 (date: 16/10/2023)
