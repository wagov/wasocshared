# Spring-Kafka Contains a Java Deserialization Vulnerability When Improperly Configured - 20230905001

## Overview

In Spring for Apache Kafka 3.0.9 and earlier and versions 2.9.10 and earlier, a possible deserialization attack vector existed, but only if unusual configuration was applied. An attacker would have to construct a malicious serialized object in one of the deserialization exception record headers.

## What is the vulnerability?

[**CVE-2023-34040**](https://nvd.nist.gov/vuln/detail/CVE-2023-34040) - CVSS v3 Base Score: ***7.8***:

Specifically, an application is vulnerable when all of the following are true:

- The user does **not** configure an ErrorHandlingDeserializer for the key and/or value of the record
- The user explicitly sets container properties checkDeserExWhenKeyNull and/or checkDeserExWhenValueNull container properties to true.
- The user allows untrusted sources to publish to a Kafka topic

**By default, these properties are false**, and the container only attempts to deserialize the headers if an ErrorHandlingDeserializer is configured. The ErrorHandlingDeserializer prevents the vulnerability by removing any such malicious headers before processing the record.

## What is vulnerable?

The vulnerability affects the following products:

- Spring for Apache Kafka versions:
    - 2.8.1 to 2.9.10
    - 3.0.0 to 3.0.9

## What has been observed?

There is no evidence of exploitation affecting Western Australian Government networks at the time of publishing.

## Recommendation

The WA SOC recommends administrators apply the solutions as per vendor instructions to all affected devices within expected timeframe of *one month...* (refer [Patch Management](../guidelines/patch-management.md)):

- <https://spring.io/security/cve-2023-34040>
